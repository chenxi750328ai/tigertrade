# 后台任务定时监控说明（Agent 必读）

**日期**: 2026-02-01  
**类别**: best_practices  
**标签**: monitor, cron, routine, demo, training

---

## 谁在监控、多久一次

- **Agent（我）不会自动定时跑**：我只有在**你发起对话并让我「检查/监控」**时，才会执行 `bash scripts/check_routine_background.sh` 或查看日志。我无法在后台按「每 N 分钟」主动执行，所以如果你不提醒，我不会自动关注错误。
- **若要「不用提醒就有人关注」**：由**系统**做定时监控——用 crontab 每 N 分钟执行一次监控脚本，结果写入 `logs/routine_monitor.log`；有真实错误时脚本返回非 0，可配合 cron 发邮件等告警。

---

## 推荐：系统定时监控（crontab）

1. **脚本**：`scripts/cron_routine_monitor.sh`  
   - 检查 20h DEMO、多模型训练是否在跑，以及 DEMO/训练日志里是否有**除 API 1200 以外的错误**。
   - 每次运行在 `logs/routine_monitor.log` 追加一行带时间戳的汇总；若有真实错误，会追加错误片段并 **exit 1**。

2. **建议 crontab（每 2 分钟，快速发现错误）**：
   ```bash
   */2 * * * * cd /home/cx/tigertrade && bash scripts/cron_routine_monitor.sh >> logs/routine_monitor.log 2>&1
   ```
   如需错误时发邮件（需系统配置 mail）：
   ```bash
   */2 * * * * cd /home/cx/tigertrade && bash scripts/cron_routine_monitor.sh >> logs/routine_monitor.log 2>&1 || (echo "例行监控发现错误，见 routine_monitor.log"; exit 1)
   ```

3. **查看监控历史**：`tail -100 logs/routine_monitor.log`

---

## 手动检查（你或 Agent 在对话里执行）

- **完整状态**：`bash scripts/check_routine_background.sh`
- **只看监控日志**：`tail -50 logs/routine_monitor.log`

---

## 小结

| 方式           | 谁执行     | 频率           |
|----------------|------------|----------------|
| 你提醒后我检查 | Agent      | 仅当你发起对话并让我监控时 |
| 系统定时监控   | crontab    | 建议每 2 分钟（快速发现错误） |

**若希望「不用提醒就有人关注」**：请在本机或服务器上添加上述 crontab（每 2 分钟），由系统定时跑 `cron_routine_monitor.sh`，约 2 分钟内发现错误；Agent 无法代替 crontab 做定时执行。
