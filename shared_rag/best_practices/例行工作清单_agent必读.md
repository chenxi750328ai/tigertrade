# 例行工作清单（Agent 必读）

**作者**: system  
**时间**: 2026-02-01  
**类别**: best_practices  
**标签**: routine, checklist, ci, coverage, stability, data, model, profit

---

## 摘要

执行「例行工作」时，必须覆盖以下全部项。Agent 不得遗漏或只做其中一部分；新接手任务时请先查本 RAG 再开工。

**按角色**：设计 / 开发 / 测试 / Leader 的**每日例行工作**与职责定义见 [项目角色与每日例行工作](项目角色与每日例行工作.md)。**Leader（陈正霞）** 除本人例行外，须**监控项目计划执行、各成员进展与问题**。

---

## 例行工作包括（完整列表）

1. **CI/CD 测试**
   - 运行项目 CI/CD 流水线或等价测试（如 `pytest tests/ -m "not real_api"`）。
   - 确保测试通过，无新增失败。

2. **覆盖率统计**
   - 执行带覆盖率收集的测试（如 `pytest --cov=src`）。
   - 查看/输出覆盖率报告，关注关键模块覆盖率。

3. **问题解决**
   - 对本次/近期暴露的 Bug、失败用例或告警进行修复与验证。
   - 记录根因与解法（可写入 RAG 或 docs）。

4. **20 小时稳定性测试（含 20 小时 DEMO 运行）**
   - **可靠性目标**：金融系统要求高可靠性；**20 小时稳定运行不出错**是项目目标之一（见 [需求分析](../../docs/需求分析和Feature测试设计.md) 1.2 可靠性目标、[CI/CD和稳定性测试流程](../../docs/CI_CD和稳定性测试流程.md)）。**不是跑一下就行**，须运行满 20h（或约定时长）且满足稳定性指标（无崩溃、错误率 &lt; 1%、有正常日志与订单输出）；跑完或定时检查运行状态与日志，异常即记录并排查。
   - **每日 DEMO 须有实盘数据，保证版本可用**：20h DEMO 运行里，除稳定性要求外，**必须有实盘数据**——即 DEMO 使用真实 API 拉取的行情（K 线/Tick）或产生可在老虎后台核对的订单；每天例行都要确保当日 DEMO 能产出实盘数据（行情或成交），不得以纯 mock/合成数据或“无新输出”视为通过。若当日因休市/维护无法获得实盘数据，须记录原因并注明“次日补跑”或等价措施。
   - **当日实盘须有订单输出**：每日 DEMO/实盘运行须有**订单输出**（即至少有一次下单尝试或成功订单记录，如 order_log/run 或 DEMO 日志中有「提交」「execute_buy」「订单」等）；若当日全程无任何订单输出，视为未达标，须排查（如未触发买入条件、风控拦截、配置错误等）并记录原因。
   - **DEMO 能运行并产出结果是例行要求；否则视为异常**。除非有可解释原因（如周末/节假日不能交易、交易所维护、已知不可抗力），否则「DEMO 未运行」或「DEMO 运行但无新日志/无订单输出」或「未跑满 20h 即崩溃」均须记为**异常**并排查原因，不得仅报「未检测到」就通过。
   - **前置检查**：执行「查看或启动」前，必须确认 **`openapicfg_dem/tiger_openapi_config.properties` 存在且可读**（路径：本机多为 `/home/cx/openapicfg_dem` 或 `tigertrade/openapicfg_dem` 指向该处）。若不存在或无法解析 account，则本次例行该项判为**未通过**并记录，不得视为通过。详见 [例行未发现openapicfg_dem丢失_回溯与改进_20260208](../insights/例行未发现openapicfg_dem丢失_回溯与改进_20260208.md)。
   - 未运行时必须**启动** DEMO（不是只查看）：`bash scripts/run_20h_demo.sh` 或 `python scripts/stability_test_20h.py`。DEMO 须有**可用的日志与输出**（如订单、止损止盈统计），供收益与算法分析使用；运行过程中或跑完后按 [CI_CD和稳定性测试流程](../../docs/CI_CD和稳定性测试流程.md) 做稳定性检查（错误率、崩溃、资源等）。
   - 记录运行状态、日志路径、是否跑满 20h、是否有新输出；未跑满或无输出时说明原因（休市/错误/配置/崩溃等）并跟进。

5. **数据刷新和模型训练**
   - **每日要有进展：新数据进入、分析与训练**。数据刷新：更新/拉取最新数据，运行 `scripts/merge_recent_data_and_train.py` 或 `scripts/data_preprocessing.py`，确保 train/val/test 等产出可用。
   - 模型训练：执行 **多模型对比训练**（LSTM、Transformer、Enhanced Transformer、MoE 等），使用 `scripts/train_multiple_models_comparison.py`，记录各模型训练进度与对比结果。
   - **即使收益没有改进，也须产出结果**：若数据增加了但收益/效果未提升，必须**分析并记录原因**（如：为何数据增加却无效果；数据质量、分布、标注、模型容量、过拟合等），写入 RAG（insights）或 docs，不得只报「跑了」无结论。
   - **注意**：当前模型（如 Transformer）不能假定为最优；在优化过程中可能发现更好的模型结构，需持续探索与对比。

6. **收益率分析和算法优化**（两项都做，不得只做其一）
   - **收益率分析**：**DEMO 实盘收益率 = 仅以老虎后台可核对的数据为准**（完成的订单的收益率）；须用老虎后台获取的数据核对，核对上的才算正确。不得用 DEMO 日志解析的百分比或未成交/模拟单冒充实盘收益率。见 [DEMO实盘收益率_定义与数据来源](../../docs/DEMO实盘收益率_定义与数据来源.md)。
   - **算法优化**：根据分析结果做策略/参数/算法层面的优化，并做对比验证；可运行 `scripts/optimize_algorithm_and_profitability.py` 等产出算法优化与收益率报告。

7. **状态页刷新**
   - 按当日/当周进展更新 **`docs/status.html`**（按特性一行一状态，分组：数据与模型、交易与风控、质量与发布）；确保与 RAG/实际进展一致。
   - 更新后**提交并推送**，由 GitHub Pages 部署生效。负责：**陈正霞（Leader/PL）**，可委托其他成员执行并回报。
   - **Agent 执行时**：提交后必须 **push 成功**；需重试推送直至成功，否则用户不在时无法刷新。若本环境多次推送超时，仍须明确提示用户本机执行 `git push origin main`。

**Leader 额外职责**（详见 [项目角色与每日例行工作](项目角色与每日例行工作.md)）：除完成上述 7 项本人例行外，须**监控项目计划执行**（计划文档与 STATUS 的进展/实际完成时间）、**成员进展与问题**（设计/开发/测试的日报或回报、阻塞与风险），并在 STATUS 或周报中体现汇总。

---

## 使用方式

- **开工前**：查本 RAG，确认本次「例行工作」要覆盖的上述 **7 类**是否都已安排；生成待办或执行计划时须按本清单 **7 项**逐条核对，不得自拟简写版或合并为少于 7 项。
- **Tiger 内找不到说明时**：依次查工作区根目录 README（如 `/home/cx/README.md`）、agentfuture 根目录 README（`/home/cx/agentfuture/README.md`）。见 [shared_rag/README](../README.md)「查找顺序」。
- **执行中**：按项执行并做简要记录（通过/失败/跳过原因）。
- **收尾**：未完成项需注明原因与下次计划。
- **推代码前**：必须本地跑与 CI 同一套测试命令（见上表「测试」），通过后再推送，避免「本地过 CI 挂」或「CI 过本地挂」。根因与改进见 `insights/CI为何通过与防止再犯_20260202.md`。
- **设计完备性**：由例行自检或 CI 验收（对照 [设计完备性_业界方案与DFX](../../docs/设计完备性_业界方案与DFX.md) 与需求分析、实现是否一致；CI 可校验相关文档存在）。不在状态页单独占一行。

**防漏（禁止简写）**：本文件为例行工作项的唯一正本。写日报、执行计划或其他文档引用「例行工作清单」时，必须以本文件为准逐项核对或复制；第 4 项须含「20 小时」「DEMO 运行」，第 6 项须同时含「收益率分析」与「算法优化」，第 7 项为「状态页刷新」。漏项原因与改进见 `insights/例行工作漏项回溯与改进_20260201.md`。

---

## 相关路径与命令（参考）

| 项目       | 说明 |
|------------|------|
| 测试       | `cd /home/cx/tigertrade && PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 python -m pytest tests/ -m "not real_api"`（与 CI 一致，推前必跑） |
| 覆盖率     | `PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 pytest tests/ -m "not real_api" --cov=src --cov-report=term-missing` |
| **20h DEMO 运行** | `bash scripts/run_20h_demo.sh` 或 `python scripts/stability_test_20h.py`（目标 20 小时） |
| 数据合并+预处理 | `python scripts/merge_recent_data_and_train.py`，产出在 `data/processed/` |
| 多模型训练 | `python scripts/train_multiple_models_comparison.py`（LSTM/Transformer/Enhanced/MoE 等） |
| **算法优化** | `python scripts/optimize_algorithm_and_profitability.py` 等，产出算法优化与收益率报告 |
| **状态页刷新** | 编辑 `docs/status.html`，按特性更新状态，提交并推送；陈正霞负责，可委托陈正与 |
| 真实 API 用例 | 需网络与配置时运行 `pytest tests/`（含 `real_api` 标记） |

---

**请勿遗忘：例行工作 = CI/CD 测试 + 覆盖率统计 + 问题解决 + 20 小时稳定性测试（含 20 小时 DEMO 运行）+ 数据刷新和模型训练（含多模型对比训练）+ 收益率分析和算法优化（收益率分析 + 算法优化，两项都做）+ 状态页刷新。**

---

## 每日进展与异常判定（必守）

1. **DEMO 必须能运行并产出结果**  
   DEMO 能运行且有输出（日志、订单/统计）是例行要求。**未运行**或**运行但无新输出**一律视为**异常**，除非有可解释原因（如周末/节假日休市、交易所维护）。异常须记录原因并排查，不得以「未检测到」等为由视为通过。

2. **每日要有进展：新数据 + 分析与结论**  
   每天要有新数据进入（采集/合并/预处理）并用于分析或训练。**即使收益没有改进，也是一个结果**：必须产出分析结论（如「为何数据增加了却无效果」），可从数据质量、分布、标注、模型容量、过拟合等角度写清原因，写入 `shared_rag/insights/` 或 `docs/`，不得只执行脚本无结论。
