# 订单业务 LOG

**作者**: system  
**时间**: 2026-02-01  
**类别**: best_practices  
**标签**: order, log, business

---

## 摘要

自动交易订单记录写入**订单业务 LOG**，用户日常只看此文件；运行日志（`logs/*.log`）仅在排查问题时查看。

---

## 订单 LOG 路径

```
tigertrade/run/order_log.jsonl
```

- 格式：JSONL（每行一个 JSON）
- 追加写入，不覆盖
- 每次 `place_tiger_order` 成功或失败都会写入一条

**建仓单与止损**：实盘只向交易所下一笔主单（限价/市价）；建仓单失败时**不会**向交易所提交止损单。止损由策略内根据价格触发后，再下一笔平仓单（如 `place_tiger_order(..., reason='stop_loss')`），LOG 中该笔会记为订单类型「止损单」。

**API 失败时客服用日志**：实盘下单失败时，除写入 `order_log.jsonl` 外，会额外写入 `run/api_failure_for_support.jsonl`，记录完整订单参数（提交合约、订单类型 LMT/MKT、数量、限价、有效期限等），便于提供给老虎客服排查「为何 APP 可下单、API 报错」。输出可读格式：`python scripts/print_api_failure_for_support.py`（可选 `-n 3` 显示最近 3 条）。

---

## 记录字段

| 字段 | 说明 |
|------|------|
| ts | 时间戳 (ISO) |
| side | BUY / SELL |
| **symbol** | 合约代码（如 SIL2603） |
| **order_type** | 这笔单子本身的类型：**market** 市价单 / **limit** 限价单 / **stop_loss** 止损单 / **take_profit** 止盈单 |
| **source** | **auto** 自动订单 / **manual** 手工订单 |
| qty | 数量（手） |
| price | 价格 |
| order_id | 订单ID |
| status | success / fail |
| mode | mock / real（模拟/实盘） |
| stop_loss | 建仓时带的**计划止损价**（可选；不是订单类型，只有 order_type=stop_loss 才是止损单） |
| take_profit | 建仓时带的**计划止盈价**（可选；不是订单类型，只有 order_type=take_profit 才是止盈单） |
| reason | 下单原因（可选） |
| error | 失败原因（失败时） |

---

## 查看命令

**推荐：多行清晰显示**
```bash
# 最近 20 条（多行显示）
python scripts/query_order_log.py

# 最近 50 条
python scripts/query_order_log.py -n 50

# 全部
python scripts/query_order_log.py -n 0

# 只看成功单
python scripts/query_order_log.py --success

# 只看失败单
python scripts/query_order_log.py --fail
```

**原始 JSONL**
```bash
tail -20 run/order_log.jsonl
tail -f run/order_log.jsonl
```
