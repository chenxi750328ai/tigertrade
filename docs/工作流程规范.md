# æ•°æ®é‡‡é›†å’Œæ¨¡å‹è®­ç»ƒå·¥ä½œæµç¨‹è§„èŒƒ

**æ—¥æœŸ**: 2026-01-20  
**ç›®çš„**: ç¡®ä¿æ•°æ®è´¨é‡ï¼Œé¿å…ä½¿ç”¨Mockæ•°æ®ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸

---

## ğŸš« ç¦æ­¢äº‹é¡¹

### ç¦æ­¢1: ä½¿ç”¨Mockæ•°æ®è®­ç»ƒæ¨¡å‹

**åŸå› **:
- Mockæ•°æ®æ˜¯ç¨‹åºç”Ÿæˆçš„å‡æ•°æ®
- ä¸ä»£è¡¨çœŸå®å¸‚åœº
- è®­ç»ƒå‡ºçš„æ¨¡å‹å®Œå…¨æ— æ•ˆ

**æ£€æŸ¥æ–¹æ³•**:
```python
from api_adapter import api_manager

# æ£€æŸ¥APIæ˜¯å¦åˆå§‹åŒ–
if api_manager.quote_api is None:
    raise RuntimeError("âŒ APIæœªåˆå§‹åŒ–ï¼Œä¼šå›é€€åˆ°Mockæ•°æ®ï¼")

# æ£€æŸ¥æ˜¯å¦Mockæ¨¡å¼
if api_manager.is_mock_mode:
    raise RuntimeError("âŒ å½“å‰å¤„äºMockæ¨¡å¼ï¼")

# æ£€æŸ¥APIç±»å‹
if 'Mock' in type(api_manager.quote_api).__name__:
    raise RuntimeError("âŒ æ£€æµ‹åˆ°Mock APIï¼")
```

### ç¦æ­¢2: å¿½ç•¥å¼‚å¸¸å’Œé”™è¯¯

**åŸå› **:
- å¼‚å¸¸å¯èƒ½å¯¼è‡´æ•°æ®è´¨é‡é—®é¢˜
- å¼‚å¸¸è¢«æ•è·åç»§ç»­æ‰§è¡Œï¼Œäº§ç”Ÿé”™è¯¯ç»“æœ
- å¿…é¡»æ£€æŸ¥æ‰€æœ‰è¾“å‡º

**æ£€æŸ¥æ–¹æ³•**:
```bash
# è¿è¡Œåæ£€æŸ¥stderr
python script.py 2> error.log
cat error.log | grep -i "error\|exception\|traceback"

# æ£€æŸ¥stdout
python script.py > output.log
cat output.log | grep -i "å¤±è´¥\|å¼‚å¸¸\|âŒ"
```

### ç¦æ­¢3: ä½¿ç”¨å¸¸é‡ç‰¹å¾è®­ç»ƒ

**åŸå› **:
- å¸¸é‡ç‰¹å¾å¯¹æ¨¡å‹æ— ç”¨
- è¡¨æ˜ç‰¹å¾è®¡ç®—å¤±è´¥
- å¿…é¡»ä¿®å¤åå†è®­ç»ƒ

**æ£€æŸ¥æ–¹æ³•**:
```python
import pandas as pd

df = pd.read_csv('data.csv')

for col in ['price_change_1', 'volatility', 'rsi_1m', 'atr']:
    unique = df[col].nunique()
    if unique == 1:
        raise ValueError(f"âŒ ç‰¹å¾ {col} æ˜¯å¸¸é‡ï¼")
```

---

## âœ… æ ‡å‡†æµç¨‹

### æµç¨‹1: æ•°æ®é‡‡é›†

```bash
# ä½¿ç”¨å¸¦éªŒè¯çš„é‡‡é›†è„šæœ¬
cd /home/cx/tigertrade
python3 src/collect_with_validation.py --symbol SIL2603
```

**æ­¥éª¤**:
1. å¼ºåˆ¶åˆå§‹åŒ–çœŸå®API
2. éªŒè¯APIä¸æ˜¯Mock
3. é‡‡é›†Kçº¿æ•°æ®
4. éªŒè¯æ•°æ®è´¨é‡ï¼ˆè¡Œæ•°ã€åˆ—ã€OHLCå…³ç³»ï¼‰
5. è®¡ç®—ç‰¹å¾
6. éªŒè¯ç‰¹å¾ï¼ˆä¸æ˜¯å¸¸é‡ï¼‰
7. æ£€æŸ¥å¼‚å¸¸
8. ä¿å­˜æ•°æ®

**æ£€æŸ¥æ¸…å•**:
- [ ] APIæ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ï¼ˆä¸æ˜¯Noneï¼‰
- [ ] æ˜¯å¦Mockæ¨¡å¼ï¼ˆå¿…é¡»ä¸ºFalseï¼‰
- [ ] Kçº¿æ•°æ®è¡Œæ•°æ˜¯å¦è¶³å¤Ÿ
- [ ] æ˜¯å¦åŒ…å«æ‰€æœ‰OHLCåˆ—
- [ ] ä»·æ ¼æ˜¯å¦æœ‰åˆç†æ³¢åŠ¨
- [ ] ç‰¹å¾æ˜¯å¦éƒ½æœ‰å˜åŒ–ï¼ˆä¸æ˜¯å¸¸é‡ï¼‰
- [ ] æ˜¯å¦æœ‰å¼‚å¸¸è¾“å‡º

### æµç¨‹2: æ•°æ®éªŒè¯

```python
from data_collection_validator import DataCollectionValidator

validator = DataCollectionValidator(strict_mode=True)

# éªŒè¯API
from api_adapter import api_manager
validator.validate_api_initialization(api_manager)

# éªŒè¯æ•°æ®
import pandas as pd
df = pd.read_csv('data.csv')
validator.validate_features(df)

# æ‰“å°æ‘˜è¦
validator.print_summary()
```

### æµç¨‹3: æ¨¡å‹è®­ç»ƒ

**å‰ææ¡ä»¶**:
1. æ•°æ®é‡‡é›†éªŒè¯é€šè¿‡
2. æ— å¼‚å¸¸
3. ç‰¹å¾å…¨éƒ¨æœ‰æ•ˆ

```bash
# åªæœ‰éªŒè¯é€šè¿‡åæ‰èƒ½è®­ç»ƒ
python3 src/train_all_models.py --data-dir /path/to/validated/data
```

---

## ğŸ” å¼‚å¸¸æ£€æŸ¥æœºåˆ¶

### æœºåˆ¶1: å®æ—¶æ£€æŸ¥

åœ¨æ¯æ¬¡è¿è¡Œåï¼š
```bash
# 1. æ£€æŸ¥stderr
command 2>&1 | tee output.log
grep -i "error\|exception" output.log

# 2. æ£€æŸ¥è¿”å›ç 
echo $?  # é0è¡¨ç¤ºå¤±è´¥

# 3. æ£€æŸ¥ç‰¹å®šå…³é”®è¯
grep -i "å¤±è´¥\|âŒ\|NoneType" output.log
```

### æœºåˆ¶2: ä»£ç ä¸­éªŒè¯

```python
# åœ¨å…³é”®ä½ç½®æ·»åŠ æ–­è¨€
assert api_manager.quote_api is not None, "APIæœªåˆå§‹åŒ–"
assert not api_manager.is_mock_mode, "ä¸å…è®¸Mockæ¨¡å¼"
assert df['price_change_1'].nunique() > 1, "ç‰¹å¾æ˜¯å¸¸é‡"
```

### æœºåˆ¶3: ä½¿ç”¨éªŒè¯å™¨

```python
from data_collection_validator import DataCollectionValidator

validator = DataCollectionValidator(strict_mode=True)

# strict_mode=Trueæ—¶ï¼Œå‘ç°é—®é¢˜ç«‹å³æŠ›å‡ºå¼‚å¸¸
# ä¸ä¼šç»§ç»­æ‰§è¡Œ
```

---

## ğŸ“Š æ•°æ®è´¨é‡æ ‡å‡†

### æ ‡å‡†1: Kçº¿æ•°æ®

```python
âœ… å¿…é¡»æ»¡è¶³ï¼š
  - è¡Œæ•° >= 100ï¼ˆ5minï¼‰æˆ– >= 500ï¼ˆ1minï¼‰
  - åŒ…å«åˆ—ï¼šopen, high, low, close, volume
  - OHLCå…³ç³»ï¼šhigh >= close >= low
  - ä»·æ ¼æœ‰æ³¢åŠ¨ï¼šstd > 0
  - ä¸æ˜¯Mockç‰¹å¾ï¼šé¦–ä»·ä¸åœ¨90Â±5ï¼Œå‡ä»·ä¸åœ¨92Â±5

âŒ æ‹’ç»ï¼š
  - æ•°æ®ä¸ºç©º
  - ç¼ºå°‘å¿…éœ€åˆ—
  - ä»·æ ¼æ— æ³¢åŠ¨ï¼ˆstd=0ï¼‰
  - ç¬¦åˆMockç‰¹å¾
```

### æ ‡å‡†2: ç‰¹å¾æ•°æ®

```python
âœ… å¿…é¡»æ»¡è¶³ï¼š
  - æ‰€æœ‰å…³é”®ç‰¹å¾éƒ½æœ‰å˜åŒ–ï¼ˆunique > 1ï¼‰
  - å…³é”®ç‰¹å¾ï¼š
    * price_change_1
    * price_change_5
    * volatility
    * rsi_1m
    * rsi_5m
    * atr
    * boll_upper
    * boll_lower

âŒ æ‹’ç»ï¼š
  - ä»»ä½•ç‰¹å¾æ˜¯å¸¸é‡ï¼ˆunique == 1ï¼‰
  - è¿‡å¤šNaNå€¼
  - ç‰¹å¾ç¼ºå¤±
```

---

## ğŸ› ï¸ å·¥å…·ä½¿ç”¨

### å·¥å…·1: æ•°æ®é‡‡é›†éªŒè¯å™¨

```python
from data_collection_validator import (
    DataCollectionValidator,
    force_real_api_initialization
)

# å¼ºåˆ¶åˆå§‹åŒ–API
api_manager = force_real_api_initialization()

# åˆ›å»ºéªŒè¯å™¨
validator = DataCollectionValidator(strict_mode=True)

# éªŒè¯
validator.validate_api_initialization(api_manager)
validator.validate_kline_data(df_5m, '5min')
validator.validate_features(df_features)

# æ£€æŸ¥æ‘˜è¦
summary = validator.get_summary()
print(f"é”™è¯¯æ•°: {summary['error_count']}")
print(f"è­¦å‘Šæ•°: {summary['warning_count']}")
print(f"æ˜¯å¦é€šè¿‡: {summary['passed']}")
```

### å·¥å…·2: å¸¦éªŒè¯çš„é‡‡é›†è„šæœ¬

```bash
# è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰éªŒè¯
python3 src/collect_with_validation.py --symbol SIL2603

# è¿”å›ç ï¼š
#   0 - æˆåŠŸ
#   1 - å¤±è´¥
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•æ¨¡æ¿

### æ•°æ®é‡‡é›†å‰

```
[ ] APIé…ç½®æ–‡ä»¶å­˜åœ¨ (/home/cx/openapicfg_dem)
[ ] ç£ç›˜ç©ºé—´å……è¶³
[ ] ç½‘ç»œè¿æ¥æ­£å¸¸
```

### æ•°æ®é‡‡é›†ä¸­

```
[ ] APIåˆå§‹åŒ–æˆåŠŸï¼ˆä¸æ˜¯Noneï¼‰
[ ] ä¸æ˜¯Mockæ¨¡å¼
[ ] APIç±»å‹ä¸åŒ…å«'Mock'
[ ] Kçº¿æ•°æ®è·å–æˆåŠŸ
[ ] æ²¡æœ‰å¼‚å¸¸è¾“å‡º
```

### æ•°æ®é‡‡é›†å

```
[ ] æ•°æ®æ–‡ä»¶å·²ç”Ÿæˆ
[ ] æ•°æ®è¡Œæ•°ç¬¦åˆé¢„æœŸ
[ ] æ‰€æœ‰ç‰¹å¾éƒ½æœ‰å˜åŒ–ï¼ˆä¸æ˜¯å¸¸é‡ï¼‰
[ ] æ£€æŸ¥æ—¥å¿—æ— å¼‚å¸¸
[ ] éªŒè¯å™¨æ£€æŸ¥é€šè¿‡
```

### æ¨¡å‹è®­ç»ƒå‰

```
[ ] æ•°æ®éªŒè¯é€šè¿‡
[ ] ç‰¹å¾ç»Ÿè®¡åˆç†
[ ] æ ‡ç­¾åˆ†å¸ƒå‡è¡¡
[ ] æ— å¸¸é‡ç‰¹å¾
```

---

## ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: APIåˆå§‹åŒ–å¤±è´¥

**ç—‡çŠ¶**:
```
api_manager.quote_api is None
```

**åŸå› **:
- é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
- é…ç½®æ–‡ä»¶å†…å®¹é”™è¯¯
- ç½‘ç»œé—®é¢˜

**è§£å†³**:
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -la /home/cx/openapicfg_dem/
cat /home/cx/openapicfg_dem/client_config.ini

# ä¿®å¤åé‡æ–°åˆå§‹åŒ–
python3 -c "
from api_adapter import api_manager
api_manager.initialize_production_apis('/home/cx/openapicfg_dem')
print('APIåˆå§‹åŒ–æˆåŠŸ')
"
```

### é—®é¢˜2: æ£€æµ‹åˆ°Mockæ•°æ®

**ç—‡çŠ¶**:
```
price_current: 90.5, 90.51, 90.52, ...
å¹³å‡ä»·æ ¼: 92.5
```

**åŸå› **:
- APIæœªåˆå§‹åŒ–ï¼Œå›é€€åˆ°Mock
- ä½¿ç”¨äº†Mockæ¨¡å¼

**è§£å†³**:
```python
# å¼ºåˆ¶ä½¿ç”¨çœŸå®API
from data_collection_validator import force_real_api_initialization
api_manager = force_real_api_initialization()
```

### é—®é¢˜3: ç‰¹å¾å…¨æ˜¯0æˆ–å¸¸é‡

**ç—‡çŠ¶**:
```
price_change_1: å…¨æ˜¯0
volatility: å…¨æ˜¯0
```

**åŸå› **:
- æ•°æ®çª—å£é•¿åº¦ä¸è¶³
- calculate_indicatorsè¿”å›é»˜è®¤å€¼
- æ•°æ®æ ¼å¼é—®é¢˜

**è§£å†³**:
```python
# æ·»åŠ è°ƒè¯•æ—¥å¿—
collector.calculate_features_optimized(df_5m, df_1m)
# æ£€æŸ¥window_5mé•¿åº¦å’Œåˆ—å
```

---

## ğŸ“„ æ–‡ä»¶ç»„ç»‡

```
tigertrade/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data_collection_validator.py  # éªŒè¯å™¨
â”‚   â”œâ”€â”€ collect_with_validation.py    # å¸¦éªŒè¯çš„é‡‡é›†
â”‚   â”œâ”€â”€ collect_large_dataset.py      # åŸå§‹é‡‡é›†å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ å·¥ä½œæµç¨‹è§„èŒƒ.md               # æœ¬æ–‡ä»¶
â”‚   â””â”€â”€ lessons_learned/              # æ•™è®­æ–‡æ¡£
â””â”€â”€ logs/
    â””â”€â”€ collection_*.log               # é‡‡é›†æ—¥å¿—
```

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **æ°¸è¿œä¸ä½¿ç”¨Mockæ•°æ®è®­ç»ƒæ¨¡å‹**
2. **æ‰€æœ‰å¼‚å¸¸å¿…é¡»æ£€æŸ¥å’Œä¿®å¤**
3. **æ•°æ®è´¨é‡å¿…é¡»éªŒè¯**
4. **ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·é¿å…äººä¸ºé”™è¯¯**
5. **é‡åˆ°é—®é¢˜ç«‹å³ç»ˆæ­¢ï¼Œä¸è¦ç»§ç»­**

---

**è®°ä½**: æ•°æ®è´¨é‡å†³å®šæ¨¡å‹è´¨é‡ï¼
