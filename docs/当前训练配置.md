# 当前训练配置

**训练时间**: 2026-01-27 12:45  
**训练状态**: 进行中

---

## 一、核心配置

### 1.1 动态序列长度

**数据量**: 10,028个样本  
**序列长度**: 500步（自动计算）
- 覆盖历史: 8.3小时（假设1分钟K线）
- 可用样本数: 9,528个
- 数据利用率: 95%

**价格相关性覆盖**:
- 滞后81步仍有显著相关性（|r|>0.1）
- 500步覆盖所有有显著相关性的历史信息

### 1.2 训练模型列表

1. **LSTM模型**（改进版）
   - 序列长度: 500步
   - 损失函数: CrossEntropyLoss + MSELoss
   - 支持收益率预测

2. **Transformer模型**
   - 序列长度: 500步
   - 支持收益率预测
   - 多头注意力机制

3. **GRU模型**
   - 序列长度: 500步
   - 支持收益率预测
   - 轻量级RNN架构

4. **Enhanced Transformer（PEFT）**
   - 序列长度: 500步
   - 参数高效微调：冻结Transformer层，只训练分类头和收益率头
   - 可训练参数: ~1.9M（7%）
   - 数据增强: Mixup (alpha=0.2, 50%概率)
   - 标签平滑: 0.2

5. **MoE Transformer（MoE + 稀疏注意力）**
   - 序列长度: 500步
   - MoE: 8个专家，每次激活2个（稀疏激活率25%）
   - 稀疏注意力: 局部窗口=20，注意力头dropout=10%
   - 总参数: ~30M，实际激活参数: ~7.5M

---

## 二、防过拟合方案

### 2.1 PEFT（参数高效微调）

**策略**: 冻结Transformer所有层，只训练分类头和收益率头
- 冻结参数: ~25M（93%）
- 可训练参数: ~1.9M（7%）
- 数据/可训练参数比例: 1:4（合理）

### 2.2 MoE（混合专家模型）

**配置**:
- 专家数量: 8个
- 每次激活: 2个（稀疏激活率25%）
- 负载均衡损失权重: 0.01
- 总参数: ~30M
- 实际激活参数: ~7.5M（25%）

### 2.3 稀疏注意力

**配置**:
- 局部窗口: 20（每个位置只关注前后20个位置）
- 注意力头dropout: 10%
- 计算复杂度: O(n×w) 而不是 O(n²)

### 2.4 数据增强

**Mixup**:
- Alpha: 0.2
- 应用概率: 50%
- 混合输入特征和收益率标签

### 2.5 其他正则化

**标签平滑**: 0.2  
**类别权重**: 自动计算（处理类别不平衡）  
**权重衰减**: 1e-3  
**梯度裁剪**: max_norm=1.0  
**早停**: patience=10

---

## 三、训练参数

### 3.1 优化器

- **类型**: AdamW
- **学习率**: 2e-4（LoRA/PEFT专用）
- **权重衰减**: 1e-3

### 3.2 学习率调度

- **类型**: CosineAnnealingLR
- **T_max**: 50
- **eta_min**: 1e-6

### 3.3 批次大小

- **训练**: 32
- **验证**: 32

### 3.4 训练轮数

- **最大轮数**: 50
- **早停**: patience=10

---

## 四、预期效果

### 4.1 序列长度优势

✅ **覆盖更多历史信息**:
- 从50步增加到500步（10倍）
- 覆盖8.3小时的历史成交情况
- 覆盖所有有显著相关性的历史信息

### 4.2 防过拟合优势

✅ **PEFT**:
- 可训练参数从26.9M减少到1.9M
- 数据/可训练参数比例从3,400:1降低到4:1

✅ **MoE + 稀疏注意力**:
- 实际激活参数只有7.5M（25%稀疏激活）
- 数据/激活参数比例: 1:950（合理）

### 4.3 预期结果

- **验证准确率**: 50%+（不再总是预测类别2）
- **训练稳定性**: 训练和验证准确率差距减小
- **收益率预测**: 更准确的收益率预测

---

## 五、训练监控

### 5.1 日志文件

- 训练日志: `/tmp/model_comparison_full_training.log`
- 模型保存: `/home/cx/trading_data/best_*.pth`
- 对比结果: `/home/cx/trading_data/model_comparison_results.txt`

### 5.2 关键指标

- 训练准确率
- 验证准确率
- 收益率MAE
- MoE辅助损失（仅MoE模型）
- 学习率变化

---

**训练状态**: 进行中  
**预计完成时间**: 根据模型数量和数据量，可能需要数小时
