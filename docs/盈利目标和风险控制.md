# 盈利目标和风险控制框架

**核心理念**: 第一目标是盈利，系统建设服务于盈利

---

## 🎯 核心盈利指标

### 月盈利率目标: 20%

**计算公式**:
```
月盈利率 = (期末净值 - 期初净值) / 期初净值 × 100%
```

**示例**:
- 初始资金: $10,000
- 月末资金: $12,000
- 月盈利率: ($12,000 - $10,000) / $10,000 = 20%

### 其他关键指标

#### 夏普比率 (Sharpe Ratio) > 2.0
```
夏普比率 = (策略收益率 - 无风险收益率) / 策略收益波动率
```
- > 2.0: 优秀
- 1.0-2.0: 良好
- < 1.0: 需要改进

#### 最大回撤 (Maximum Drawdown) < 10%
```
最大回撤 = (峰值 - 谷值) / 峰值 × 100%
```
- < 5%: 优秀
- 5-10%: 可接受
- > 10%: 风险过高

#### 胜率 (Win Rate) > 60%
```
胜率 = 盈利交易次数 / 总交易次数 × 100%
```

#### 盈亏比 (Profit/Loss Ratio) > 2:1
```
盈亏比 = 平均盈利 / 平均亏损
```

---

## 📊 阶段性盈利目标

### 第1周：验证阶段
**目标**: 回测盈利率 > 15%

**任务**:
- [ ] 完成Transformer模型训练
- [ ] 提取可解释特征
- [ ] 设计交易策略
- [ ] 回测验证（至少60天数据）
- [ ] 达成回测盈利率 > 15%

**评估**:
```python
backtest_results = {
    'return': 0.15,      # 15%
    'sharpe': 2.0,
    'max_drawdown': 0.08,
    'win_rate': 0.62,
    'profit_loss_ratio': 2.1
}
```

### 第2-4周：小资金实盘
**目标**: 月化盈利 > 10%

**任务**:
- [ ] 小资金开仓（$1,000 - $5,000）
- [ ] 严格执行策略
- [ ] 每日记录盈亏
- [ ] 每周复盘分析
- [ ] 月化盈利 > 10%

**风险控制**:
- 单笔最大亏损: < $50
- 日内最大亏损: < $100
- 周最大亏损: < $200

### 第2-3月：稳定盈利
**目标**: 月盈利 15-20%

**任务**:
- [ ] 扩大资金规模（$5,000 - $20,000）
- [ ] 优化策略参数
- [ ] 多市场状态验证
- [ ] 稳定月盈利 15-20%

**优化方向**:
- 降低回撤
- 提高胜率
- 改善盈亏比

### 第3-6月：达标并稳定
**目标**: 月盈利 20%，回撤 < 10%

**任务**:
- [ ] 连续3个月达到20%
- [ ] 最大回撤控制在10%以内
- [ ] 建立自动化交易系统
- [ ] 多合约分散风险

---

## 🛡️ 风险控制体系

### 1. 止损机制

#### 单笔止损
```python
max_loss_per_trade = account_value * 0.02  # 单笔最大亏损2%

if current_loss >= max_loss_per_trade:
    close_position()  # 强制平仓
```

#### 日内止损
```python
max_daily_loss = account_value * 0.05  # 日内最大亏损5%

if daily_loss >= max_daily_loss:
    stop_trading_today()  # 停止当天交易
```

#### 周止损
```python
max_weekly_loss = account_value * 0.10  # 周最大亏损10%

if weekly_loss >= max_weekly_loss:
    pause_trading_this_week()  # 暂停本周交易，复盘
```

### 2. 仓位管理

#### 凯利公式（Kelly Criterion）
```python
f = (p * b - q) / b

where:
  f = 建议仓位比例
  p = 胜率
  q = 1 - p (败率)
  b = 盈亏比

# 示例：胜率60%，盈亏比2:1
f = (0.6 * 2 - 0.4) / 2 = 0.4  # 建议40%仓位

# 实际使用：Kelly公式的1/2或1/4（更保守）
actual_position = f * 0.5  # 20%
```

#### 固定比例法
```python
# 保守：每笔10-20%
position_size = account_value * 0.15

# 激进：每笔30-50%（需要高胜率支撑）
position_size = account_value * 0.35
```

### 3. 风险分散

#### 时间分散
- 不要在同一时刻全仓
- 分批建仓，分批平仓

#### 品种分散（长期）
- 白银 (SIL)
- 黄金 (GC)
- 原油 (CL)
- 等

#### 策略分散
- 趋势跟踪策略
- 均值回归策略
- 高频套利策略

---

## 📈 盈利追踪和复盘

### 每日记录

```python
daily_record = {
    'date': '2026-01-21',
    'trades': 3,
    'wins': 2,
    'losses': 1,
    'profit': 150.00,
    'loss': -50.00,
    'net_profit': 100.00,
    'return': 0.01,  # 1%
    'account_value': 10100.00,
    'notes': '市场上涨，趋势策略表现好'
}
```

### 每周复盘

```python
weekly_review = {
    'week': 3,
    'total_trades': 15,
    'win_rate': 0.60,
    'profit_loss_ratio': 2.1,
    'weekly_return': 0.05,  # 5%
    'max_drawdown': 0.03,   # 3%
    'lessons_learned': [
        '震荡市场需要降低仓位',
        '止损设置可以更灵活',
        '周五尾盘避免开新仓'
    ],
    'next_week_plan': [
        '测试新的Market Regime识别',
        '优化止损算法',
        '增加成交量过滤条件'
    ]
}
```

### 每月总结

```python
monthly_summary = {
    'month': '2026-01',
    'starting_capital': 10000.00,
    'ending_capital': 12000.00,
    'monthly_return': 0.20,  # 20% ✅
    'sharpe_ratio': 2.1,
    'max_drawdown': 0.08,
    'total_trades': 60,
    'win_rate': 0.62,
    'best_day': +450.00,
    'worst_day': -180.00,
    'key_insights': [
        '趋势跟踪策略在上涨市场表现优秀',
        '需要增加对下跌市场的应对策略',
        '止损执行及时，有效控制了回撤'
    ],
    'next_month_focus': [
        '积累下跌市场数据',
        '开发做空策略',
        '提高策略泛化性'
    ]
}
```

---

## 🚨 风险预警系统

### 自动告警

```python
def check_risk_alerts(account):
    alerts = []
    
    # 1. 连续亏损告警
    if account.consecutive_losses >= 3:
        alerts.append('⚠️ 连续3次亏损，建议暂停交易复盘')
    
    # 2. 回撤告警
    if account.current_drawdown >= 0.08:
        alerts.append('🚨 回撤已达8%，接近10%上限')
    
    # 3. 胜率下降告警
    if account.recent_win_rate < 0.50:
        alerts.append('⚠️ 近期胜率低于50%，策略可能失效')
    
    # 4. 盈亏比恶化告警
    if account.profit_loss_ratio < 1.5:
        alerts.append('⚠️ 盈亏比低于1.5，风险收益比不佳')
    
    return alerts
```

### 紧急止损

```python
def emergency_stop(account):
    """紧急情况强制平仓"""
    
    # 条件1：单日亏损超过10%
    if account.daily_loss >= account.value * 0.10:
        close_all_positions()
        send_alert('🚨 单日亏损10%，已强制平仓')
    
    # 条件2：账户总亏损超过30%
    if account.total_loss >= initial_capital * 0.30:
        close_all_positions()
        pause_system()
        send_alert('🚨 总亏损30%，系统已暂停')
    
    # 条件3：系统异常（如API连接失败）
    if system_error_detected():
        close_all_positions()
        send_alert('🚨 系统异常，已平仓所有持仓')
```

---

## 📝 盈利优化策略

### 1. 提高胜率
- 更严格的入场条件
- 更好的Market Regime识别
- 避免震荡市场频繁交易

### 2. 提高盈亏比
- 让盈利充分奔跑（移动止损）
- 及时止损（严格执行）
- 优化止盈点位

### 3. 降低回撤
- 分散投资（时间、品种、策略）
- 动态调整仓位（高波动降仓位）
- 及时止损（避免大亏）

### 4. 提高交易频率（谨慎）
- 更短周期的策略
- 高频套利机会
- 但要注意：交易成本和过度拟合

---

## 🎓 关键经验

### DO ✅
1. **严格执行止损** - 永远不要侥幸
2. **记录每笔交易** - 数据是优化的基础
3. **小资金验证** - 先验证再扩大
4. **持续学习** - 市场在变，策略也要变
5. **保持冷静** - 情绪化交易是大忌

### DON'T ❌
1. **不要孤注一掷** - 单笔重仓
2. **不要频繁调整** - 给策略足够的时间
3. **不要追涨杀跌** - 遵循策略信号
4. **不要忽视风险** - 盈利重要，保本更重要
5. **不要过度优化** - 避免曲线拟合

---

## 📊 盈利追踪仪表盘（建议开发）

```
┌─────────────────────────────────────────────┐
│  TigerTrade 盈利监控                         │
├─────────────────────────────────────────────┤
│  当前月份: 2026-01                           │
│  月盈利率: 18.5% / 20% (目标)              │
│  夏普比率: 2.1 ✅                           │
│  最大回撤: 7.2% ✅                          │
│  本月交易: 45笔                              │
│  胜率: 64% ✅                               │
│  盈亏比: 2.3:1 ✅                           │
├─────────────────────────────────────────────┤
│  今日盈亏: +$150 (+1.5%)                    │
│  本周盈亏: +$380 (+3.8%)                    │
│  持仓: 2个 (风险度: 中)                      │
├─────────────────────────────────────────────┤
│  风险告警: 无 ✅                            │
│  系统状态: 正常运行 ✅                      │
│  Tick采集: 运行中 ✅                        │
│  模型状态: 训练完成 ✅                      │
└─────────────────────────────────────────────┘
```

---

**记住：盈利是第一目标，但要在风险可控的前提下实现！**
