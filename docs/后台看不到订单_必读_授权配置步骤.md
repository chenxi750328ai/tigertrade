# 后台看不到订单？必读：Tiger 账户授权配置

**现象**：程序显示“下单成功”或没有报错，但 Tiger 后台看不到任何订单。

**重要区分**：
- **账户对标的权限**：你手工用该账户能交易 SIL2603，说明账户对 SIL2603 有权限，没问题。
- **API 用户对 account 的授权**：程序用的是「API 用户（tiger_id）+ 私钥」调接口，请求里再带上 account。Tiger 会校验：**当前这个 API 用户是否被允许代表该 account 下单**。若未在后台做「API 账户授权」绑定，就会报 `account is not authorized to the api user`，后台也不会有订单。

---

## 一、你需要做的（在 Tiger 后台）

1. **登录 Tiger 证券后台**（网页端，不是本机程序）。
2. **找到「API 管理」或「开发者」相关菜单**，进入 **「账户授权」** 或 **「API 账户绑定」** 等类似页面。
3. **把当前使用的账户授权给当前 API 用户**：
   - 当前配置的 **account**：见本地 `openapicfg_dem/tiger_openapi_config.properties`（勿提交该文件）
   - 当前配置的 **API 用户（tiger_id）**：同上配置文件
   - 在后台把该 **account** 授权/绑定给该 **tiger_id**。
4. **保存**，等待生效（通常几分钟内）。

不同版本后台菜单可能叫「API 管理」「开发者中心」「账户授权」「API 授权」等，以你实际界面为准。

---

## 二、授权完成后如何验证

在项目根目录执行：

```bash
cd /home/cx/tigertrade
python scripts/check_authorization.py
```

- 若输出 **「授权检查通过」**：说明授权已生效，之后再下单应能在 Tiger 后台看到订单。
- 若仍报 **「not authorized」**：说明后台尚未生效或未正确授权，请按上面步骤再检查一次。

也可用现有查询脚本（授权通过后可用于查订单）：

```bash
python scripts/query_orders.py
```

---

## 三、为什么代码“看起来”没问题

- 代码已正确传 `account`、合约代码格式（如 SIL2603）也已按 API 要求处理。
- 但 **Tiger 服务端会先校验「该 account 是否已授权给当前 API 用户」**；未授权则直接拒绝，不会在后台产生订单。
- 因此：**只要授权未在 Tiger 后台配置好，无论本地代码如何改，后台都看不到订单。**

总结：**请在 Tiger 后台完成「你的 account → 你的 API 用户（tiger_id）」的授权，再用 `scripts/check_authorization.py` 验证。**

若你**已做过上述授权**仍报 `account is not authorized to the api user`：请看程序日志里 `[下单调试]` 打印的 **account** 和 **tiger_id**，与 Tiger 后台「API 账户授权」里绑定的 account / 应用是否完全一致（例如是否用了另一套 key 或另一账户）。代码已为 SIL2603 使用 COMEX + expiry 构建合约，若仍失败请把完整报错或日志贴出便于继续排查。
