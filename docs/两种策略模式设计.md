# 两种策略模式设计

**设计时间**: 2026-01-23  
**目标**: 实现计算模式和大模型识别模式两种策略

---

## 🎯 一、两种模式对比

### 1.1 模式1: 计算模式（Hybrid Mode）

**设计思路**:
- 规则计算所有技术指标和参数（RSI, ATR, Bollinger, 网格参数等）
- 模型预测动作和网格调整系数
- 适合：快速部署，可解释性强，稳定性好

**输入特征（12维）**:
```
1. price_current (价格)
2. atr (计算)
3. rsi_1m (计算)
4. rsi_5m (计算)
5. grid_lower (计算)
6. grid_upper (计算)
7. boll_upper (计算)
8. boll_mid (计算)
9. boll_lower (计算)
10. boll_position (计算)
11. volatility (计算)
12. volume_1m (原始)
```

**模型输出**:
- 动作（3类分类：不操作、买入、卖出）
- 网格调整系数（回归，范围 [0.8, 1.2]）

**优点**:
- ✅ 可解释性强（参数都是计算出来的）
- ✅ 稳定性好（规则计算保证一致性）
- ✅ 易于调试（可以单独检查每个参数）

**缺点**:
- ❌ 依赖规则计算的准确性
- ❌ 可能错过模型能识别的复杂模式

### 1.2 模式2: 大模型识别模式（Pure ML Mode）

**设计思路**:
- 只输入原始价格数据（OHLCV）
- 模型自己识别所有特征和参数
- 适合：端到端学习，适应性强，能发现复杂模式

**输入特征（10维，序列）**:
```
1分钟数据:
1. open_1m
2. high_1m
3. low_1m
4. close_1m
5. volume_1m

5分钟数据:
6. open_5m
7. high_5m
8. low_5m
9. close_5m
10. volume_5m
```

**模型输出**:
- 动作（3类分类：不操作、买入、卖出）
- 网格参数（grid_lower, grid_upper, grid_step）
- 技术指标（可选：RSI, ATR, Bollinger等）
- 市场状态（可选：trend, volatility等）

**优点**:
- ✅ 端到端学习（不需要人工特征工程）
- ✅ 适应性强（能自动适应市场变化）
- ✅ 能发现复杂模式（模型可以学习非线性关系）

**缺点**:
- ❌ 可解释性差（黑盒模型）
- ❌ 需要更多数据训练
- ❌ 可能过拟合

---

## 🔧 二、实施细节

### 2.1 模型架构

**计算模式（Hybrid）**:
```python
TradingLSTM(
    input_size=12,  # 计算好的特征
    hidden_size=64,
    num_layers=2,
    output_size=3,  # 动作
    predict_grid_adjustment=True  # 网格调整系数
)
```

**大模型识别模式（Pure ML）**:
```python
TradingLSTM(
    input_size=10,  # 原始OHLCV数据
    hidden_size=128,  # 更大的隐藏层
    num_layers=3,  # 更深的网络
    output_size=3,  # 动作
    predict_grid_adjustment=True,  # 网格参数
    predict_indicators=True  # 技术指标（可选）
)
```

### 2.2 特征提取

**计算模式**:
```python
def prepare_features(self, row):
    # 使用计算好的特征
    features = [
        row['price_current'],
        row['atr'],
        row['rsi_1m'],
        ...
    ]
    return features
```

**大模型识别模式**:
```python
def prepare_features(self, row):
    # 只使用原始OHLCV数据
    features = [
        row['open_1m'],
        row['high_1m'],
        row['low_1m'],
        row['close_1m'],
        row['volume_1m'],
        row['open_5m'],
        row['high_5m'],
        row['low_5m'],
        row['close_5m'],
        row['volume_5m']
    ]
    return features
```

### 2.3 训练逻辑

**计算模式**:
- 输入：计算好的特征（12维）
- 标签：动作 + 网格调整系数（基于历史最优值）
- 损失：动作分类损失 + 网格调整回归损失

**大模型识别模式**:
- 输入：原始OHLCV数据（10维）
- 标签：动作 + 网格参数（基于历史最优值）
- 损失：动作分类损失 + 网格参数回归损失

---

## 📊 三、使用场景

### 3.1 计算模式适用场景

- ✅ 需要快速部署
- ✅ 需要可解释性
- ✅ 规则计算已经比较准确
- ✅ 数据量较小

### 3.2 大模型识别模式适用场景

- ✅ 有大量历史数据
- ✅ 市场模式复杂
- ✅ 需要端到端学习
- ✅ 可以接受黑盒模型

---

## 🔄 四、模式切换

### 4.1 初始化时选择模式

```python
# 计算模式
strategy = LLMTradingStrategy(mode='hybrid')

# 大模型识别模式
strategy = LLMTradingStrategy(mode='pure_ml')
```

### 4.2 运行时切换（可选）

```python
# 动态切换模式（需要重新加载模型）
strategy.set_mode('pure_ml')
```

---

## ✅ 五、实施状态

### 5.1 计算模式

- ✅ 模型架构已支持
- ✅ 特征提取已实现
- ⚠️ 训练逻辑待完善
- ⚠️ 准确率计算待改进

### 5.2 大模型识别模式

- ⚠️ 模型架构待实现（需要更大的模型）
- ⚠️ 特征提取待实现（需要原始OHLCV数据）
- ⚠️ 训练逻辑待实现
- ⚠️ 预测逻辑待实现

---

**状态**: 计算模式部分完成，大模型识别模式待实现
