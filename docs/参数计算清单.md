# 参数计算清单

**分析时间**: 2026-01-23  
**目的**: 识别所有计算出来的参数，设计两种策略模式

---

## 📊 一、当前计算出来的参数

### 1.1 技术指标（计算）

| 参数 | 计算方式 | 位置 | 说明 |
|------|----------|------|------|
| **RSI_1m** | `calculate_indicators()` | `tiger1.py:414-422` | 1分钟RSI，周期14 |
| **RSI_5m** | `calculate_indicators()` | `tiger1.py:434-442` | 5分钟RSI，周期14 |
| **ATR** | `calculate_indicators()` | `tiger1.py:465-473` | 5分钟ATR，周期14 |
| **Bollinger Upper** | `calculate_indicators()` | `tiger1.py:449-454` | 布林带上轨，周期20，标准差2 |
| **Bollinger Middle** | `calculate_indicators()` | `tiger1.py:451-455` | 布林带中轨，周期20 |
| **Bollinger Lower** | `calculate_indicators()` | `tiger1.py:450-454` | 布林带下轨，周期20，标准差2 |

### 1.2 网格参数（计算）

| 参数 | 计算方式 | 位置 | 说明 |
|------|----------|------|------|
| **grid_lower** | `adjust_grid_interval()` | `tiger1.py:514` | 网格下轨，基于时段自适应策略 |
| **grid_upper** | `adjust_grid_interval()` | `tiger1.py:514` | 网格上轨，基于时段自适应策略 |
| **grid_step** | `adjust_grid_interval()` | `time_period_strategy.py` | 网格间距，基于平衡阈值 |

### 1.3 市场状态（计算）

| 参数 | 计算方式 | 位置 | 说明 |
|------|----------|------|------|
| **trend** | `judge_market_trend()` | `tiger1.py:478` | 市场趋势（bull_trend, bear_trend, osc_bull, osc_bear, osc_normal等） |
| **volatility** | 时段自适应策略 | `time_period_strategy.py` | 波动率 |
| **slippage_rate** | 时段自适应策略 | `time_period_strategy.py` | 滑点率 |

### 1.4 交易条件（计算）

| 参数 | 计算方式 | 位置 | 说明 |
|------|----------|------|------|
| **buffer** | `max(atr * 0.3, 0.0025)` | `tiger1.py:2882` | 缓冲区 |
| **threshold** | `grid_lower + buffer` | `tiger1.py:2883` | 阈值 |
| **near_lower** | `price_current <= threshold` | `tiger1.py:2895` | 是否接近下轨 |
| **rsi_ok** | `rsi_1m < 30 or (rsi_5m > 45 and rsi_5m < 55)` | `tiger1.py:2896` | RSI条件 |
| **trend_check** | 基于trend和rsi_5m | `tiger1.py:2303` | 趋势检查 |
| **rebound** | `last > prev` | `tiger1.py:2313` | 反弹检测 |
| **vol_ok** | 基于成交量 | `tiger1.py:2314-2324` | 成交量条件 |

---

## 🎯 二、两种策略模式设计

### 2.1 模式1: 计算模式（Hybrid Mode）

**设计思路**:
- 规则计算所有技术指标和参数
- 模型预测动作和网格调整系数
- 适合：快速部署，可解释性强

**输入特征**:
```
1. price_current (价格)
2. atr (计算)
3. rsi_1m (计算)
4. rsi_5m (计算)
5. grid_lower (计算)
6. grid_upper (计算)
7. boll_upper (计算)
8. boll_mid (计算)
9. boll_lower (计算)
10. boll_position (计算)
11. volatility (计算)
12. volume_1m (原始)
```

**模型输出**:
- 动作（3类分类：不操作、买入、卖出）
- 网格调整系数（回归，范围 [0.8, 1.2]）

### 2.2 模式2: 大模型识别模式（Pure ML Mode）

**设计思路**:
- 只输入原始价格数据（OHLCV）
- 模型自己识别所有特征和参数
- 适合：端到端学习，适应性强

**输入特征**:
```
原始数据（序列）:
- open, high, low, close, volume (1分钟)
- open, high, low, close, volume (5分钟)
- 时间特征（小时、分钟、星期等）
```

**模型输出**:
- 动作（3类分类：不操作、买入、卖出）
- 网格参数（grid_lower, grid_upper, grid_step）
- 技术指标（RSI, ATR, Bollinger等，可选）
- 市场状态（trend, volatility等，可选）

---

## 🔧 三、实施计划

### 3.1 模式1: 计算模式（当前模式）

**状态**: ✅ 已实现（部分）

**需要完善**:
1. ✅ 统一特征提取（已完成）
2. ⚠️ 训练逻辑（支持网格调整系数训练）
3. ⚠️ 准确率计算（使用收益加权准确率）

### 3.2 模式2: 大模型识别模式

**状态**: ⚠️ 待实现

**需要实现**:
1. 修改模型架构（输入原始OHLCV数据）
2. 修改特征提取（只使用原始数据）
3. 修改训练逻辑（端到端学习）
4. 修改预测逻辑（模型输出所有参数）

---

## 📝 四、代码结构设计

### 4.1 策略模式配置

```python
class StrategyMode:
    HYBRID = "hybrid"  # 计算模式：规则计算+模型预测
    PURE_ML = "pure_ml"  # 大模型识别模式：模型自己识别
```

### 4.2 模型架构选择

```python
class TradingLSTM:
    def __init__(self, mode="hybrid", ...):
        self.mode = mode
        if mode == "hybrid":
            # 输入：计算好的特征（12维）
            # 输出：动作 + 网格调整系数
        elif mode == "pure_ml":
            # 输入：原始OHLCV数据（序列）
            # 输出：动作 + 网格参数 + 技术指标（可选）
```

---

## ✅ 五、总结

### 5.1 计算出来的参数

- **技术指标**: RSI, ATR, Bollinger Bands
- **网格参数**: grid_lower, grid_upper, grid_step
- **市场状态**: trend, volatility, slippage_rate
- **交易条件**: buffer, threshold, near_lower, rsi_ok, trend_check, rebound, vol_ok

### 5.2 两种策略模式

1. **计算模式（Hybrid）**: 规则计算参数，模型预测动作和调整
2. **大模型识别模式（Pure ML）**: 模型自己识别所有特征和参数

### 5.3 下一步

1. 完善计算模式的训练逻辑
2. 实现大模型识别模式
3. 支持两种模式切换

---

**状态**: 参数清单已整理，两种模式设计已完成
