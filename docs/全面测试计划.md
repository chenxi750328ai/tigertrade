# 全面测试计划

**日期**: 2026-01-27  
**目标**: 从26个测试用例扩展到260+个测试用例

## 一、项目规模分析

### 代码规模
- **Python文件数**: 69个
- **函数/类定义**: 211个
- **当前测试用例**: 26个
- **目标测试用例**: 260+个（至少每个函数1个测试，关键函数多个测试）

### 模块分类

#### 1. 核心交易模块 (`tiger1.py`)
- **函数数**: ~50+
- **需要测试用例**: 100+
- **关键功能**:
  - 订单管理（下单、撤单、查询）
  - 风控检查
  - 止损止盈计算
  - 技术指标计算
  - 网格策略
  - 数据获取

#### 2. 策略模块 (`src/strategies/`)
- **策略数量**: 15+
- **需要测试用例**: 150+
- **策略类型**:
  - LSTM策略
  - Transformer策略
  - MoE策略
  - GRU策略
  - 增强Transformer
  - 强化学习策略
  - 数据驱动优化
  - 时段自适应策略

#### 3. 执行器模块 (`src/executor/`)
- **模块数**: 3
- **需要测试用例**: 30+
- **模块**:
  - MarketDataProvider
  - OrderExecutor
  - TradingExecutor

#### 4. 数据收集和处理 (`src/data_collector/`, `src/data_processor/`)
- **模块数**: 6+
- **需要测试用例**: 40+
- **功能**:
  - K线数据获取
  - Tick数据收集
  - 数据清洗
  - 数据归一化
  - 数据分割

#### 5. API适配器 (`src/api_adapter.py`, `src/api_agent.py`)
- **模块数**: 2
- **需要测试用例**: 20+
- **功能**:
  - API连接管理
  - 数据获取
  - 订单执行

#### 6. 风险管理 (`src/risk/`)
- **模块数**: 1
- **需要测试用例**: 15+
- **功能**:
  - 风险计算
  - 仓位管理
  - 止损管理

#### 7. 协调器模块 (`src/coordinator/`)
- **模块数**: 5
- **需要测试用例**: 25+
- **功能**:
  - 多Agent协调
  - 选举机制
  - 协议治理

#### 8. 训练和回测模块
- **脚本数**: 20+
- **需要测试用例**: 30+
- **功能**:
  - 模型训练
  - 回测验证
  - 参数优化

## 二、测试用例分类

### 1. 单元测试 (Unit Tests) - 目标: 180+
- **tiger1.py核心功能**: 100+
- **策略模块**: 50+
- **数据模块**: 20+
- **其他模块**: 10+

### 2. 集成测试 (Integration Tests) - 目标: 50+
- **策略+执行器**: 15+
- **数据+策略**: 15+
- **API+交易**: 10+
- **端到端流程**: 10+

### 3. 边界测试 (Boundary Tests) - 目标: 20+
- **极端价格**: 5+
- **极端仓位**: 5+
- **极端时间**: 5+
- **极端数据**: 5+

### 4. 异常测试 (Exception Tests) - 目标: 10+
- **API错误**: 3+
- **数据错误**: 3+
- **网络错误**: 2+
- **其他异常**: 2+

## 三、测试用例生成计划

### 阶段1: 核心模块测试 (tiger1.py) - 100个用例
1. 订单管理测试 (20个)
   - place_tiger_order各种场景
   - 撤单测试
   - 订单查询
   - 订单状态管理

2. 风控测试 (20个)
   - check_risk_control各种场景
   - 仓位限制
   - 亏损限制
   - 单笔限制

3. 止损止盈测试 (15个)
   - compute_stop_loss各种场景
   - 止盈计算
   - 动态调整

4. 技术指标测试 (20个)
   - calculate_indicators各种指标
   - 不同时间周期
   - 边界情况

5. 网格策略测试 (15个)
   - 网格计算
   - 参数调整
   - 不同市场状态

6. 数据获取测试 (10个)
   - K线数据
   - Tick数据
   - 历史数据

### 阶段2: 策略模块测试 - 150个用例
1. LSTM策略 (20个)
2. Transformer策略 (20个)
3. MoE策略 (20个)
4. GRU策略 (15个)
5. 增强Transformer (20个)
6. 其他策略 (55个)

### 阶段3: 执行器和数据模块 - 70个用例
1. 执行器模块 (30个)
2. 数据收集 (20个)
3. 数据处理 (20个)

### 阶段4: 集成和端到端测试 - 50个用例
1. 完整交易流程 (20个)
2. 策略切换 (10个)
3. 数据流 (10个)
4. 错误恢复 (10个)

## 四、测试用例模板

### 单元测试模板
```python
def test_function_name_normal_case(self):
    """测试正常情况"""
    pass

def test_function_name_edge_case(self):
    """测试边界情况"""
    pass

def test_function_name_error_case(self):
    """测试错误情况"""
    pass

def test_function_name_with_mock(self):
    """测试Mock场景"""
    pass
```

### 集成测试模板
```python
def test_module_a_with_module_b(self):
    """测试模块A与模块B的集成"""
    pass
```

## 五、执行计划

1. **立即开始**: 生成tiger1.py的100个测试用例
2. **第1天**: 完成核心模块测试
3. **第2天**: 完成策略模块测试
4. **第3天**: 完成执行器和数据模块测试
5. **第4天**: 完成集成测试
6. **第5天**: 测试优化和文档

## 六、质量保证

- **代码覆盖率目标**: >80%
- **关键路径覆盖率**: 100%
- **所有测试必须通过**: ✅
- **CI/CD集成**: 自动运行所有测试

---

**状态**: 🚀 开始执行
