# ä¿®å¤å’Œæµ‹è¯•æ€»ç»“

**å®Œæˆæ—¶é—´**: 2026-01-23  
**çŠ¶æ€**: Transformerè®­ç»ƒé—®é¢˜å·²ä¿®å¤ï¼Œå®Œæ•´å¯¹æ¯”æµ‹è¯•è¿è¡Œä¸­

---

## âœ… ä¸€ã€ä¿®å¤çš„é—®é¢˜

### 1.1 Transformerè®­ç»ƒæ•°æ®é‡ä¸è¶³ âœ…

**é—®é¢˜**: Transformerè®­ç»ƒæ—¶åªæœ‰1ä¸ªç±»åˆ«ï¼Œå¯¼è‡´ç±»åˆ«æƒé‡é”™è¯¯

**ä¿®å¤**:
- æ£€æŸ¥ç±»åˆ«æ•°é‡ï¼Œå¦‚æœä¸è¶³3ä¸ªï¼Œä½¿ç”¨é»˜è®¤æŸå¤±å‡½æ•°ï¼ˆä¸ä½¿ç”¨ç±»åˆ«æƒé‡ï¼‰
- ç¡®ä¿æ•°æ®å‡†å¤‡æ–¹å¼ä¸LSTMä¸€è‡´ï¼ˆä½¿ç”¨åºåˆ—ç‰¹å¾ï¼‰

### 1.2 Transformeræ•°æ®å‡†å¤‡æ–¹å¼ âœ…

**é—®é¢˜**: Transformerä½¿ç”¨å•ç‚¹ç‰¹å¾ï¼Œä¸LSTMçš„åºåˆ—ç‰¹å¾ä¸ä¸€è‡´

**ä¿®å¤**:
- ä¿®æ”¹Transformerçš„`train_model`æ–¹æ³•ï¼Œä½¿ç”¨åºåˆ—ç‰¹å¾ï¼ˆä¸LSTMä¸€è‡´ï¼‰
- æ„å»ºåºåˆ—ï¼šä½¿ç”¨æœ€è¿‘seq_lengthä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾
- ç¡®ä¿æ•°æ®å½¢çŠ¶ä¸º3D (n_samples, seq_length, features)

### 1.3 Transformerè®­ç»ƒé…ç½® âœ…

**ä¿®å¤**:
- å¢åŠ è®­ç»ƒè½®æ¬¡åˆ°50ï¼ˆä¸LSTMä¸€è‡´ï¼‰
- æ·»åŠ æ—©åœæœºåˆ¶ï¼ˆpatience=10ï¼‰
- æ·»åŠ å­¦ä¹ ç‡è°ƒåº¦ï¼ˆReduceLROnPlateauï¼‰
- ä¿å­˜æœ€ä½³æ¨¡å‹

### 1.4 è¾“å…¥ç»´åº¦é”™è¯¯ âœ…

**é—®é¢˜**: batch_xå·²ç»æ˜¯3Dï¼Œä½†ä»£ç ä¸­åˆunsqueezeï¼Œå¯¼è‡´4D

**ä¿®å¤**:
- æ£€æŸ¥batch_xçš„ç»´åº¦
- å¦‚æœå·²ç»æ˜¯3Dï¼Œç›´æ¥ä½¿ç”¨
- å¦‚æœæ˜¯2Dï¼Œæ‰unsqueeze

---

## ğŸ”§ äºŒã€ä¿®å¤è¯¦æƒ…

### 2.1 Transformerè®­ç»ƒæ–¹æ³•ä¿®æ”¹

**ä¹‹å‰**:
```python
for i in range(len(df) - look_ahead):
    row = df.iloc[i]
    features = self.prepare_features(row)  # å•ç‚¹ç‰¹å¾
    X.append(features)
```

**ç°åœ¨**:
```python
for i in range(min_required, len(df)):
    # å‡†å¤‡åºåˆ—ç‰¹å¾ï¼ˆå†å²seq_lengthä¸ªæ—¶é—´æ­¥ï¼‰
    sequence_features = []
    for j in range(max(0, i - seq_length + 1), i + 1):
        row = df.iloc[j]
        features = self.prepare_features(row)
        sequence_features.append(features)
    # æ„å»ºåºåˆ—
    sequence = np.array(sequence_features[-seq_length:], dtype=np.float32)
    X.append(sequence)
```

### 2.2 ç±»åˆ«æƒé‡å¤„ç†

**ä¹‹å‰**:
```python
class_weights = self.calculate_class_weights(y)
self.criterion = nn.CrossEntropyLoss(weight=class_weights)
```

**ç°åœ¨**:
```python
unique_labels = np.unique(y)
if len(unique_labels) < 3:
    class_weights = None
else:
    class_weights = self.calculate_class_weights(y)

if class_weights is not None and len(class_weights) == 3:
    self.criterion = nn.CrossEntropyLoss(weight=class_weights)
else:
    self.criterion = nn.CrossEntropyLoss()  # ä¸ä½¿ç”¨ç±»åˆ«æƒé‡
```

### 2.3 è®­ç»ƒé…ç½®ç»Ÿä¸€

**LSTMå’ŒTransformerç°åœ¨ä½¿ç”¨ç›¸åŒçš„é…ç½®**:
- åºåˆ—é•¿åº¦: 10
- è®­ç»ƒè½®æ¬¡: 50ï¼ˆå¯é…ç½®ï¼‰
- æ—©åœè€å¿ƒ: 10
- å­¦ä¹ ç‡è°ƒåº¦: ReduceLROnPlateau
- æ•°æ®å‡†å¤‡: åºåˆ—ç‰¹å¾

---

## ğŸ“Š ä¸‰ã€æµ‹è¯•çŠ¶æ€

### 3.1 è®­ç»ƒé€»è¾‘æµ‹è¯• âœ…

- âœ… LSTMè®­ç»ƒé€»è¾‘æµ‹è¯•é€šè¿‡
- âœ… Transformerè®­ç»ƒé€»è¾‘æµ‹è¯•é€šè¿‡
- âœ… æ‰€æœ‰æ–°åŠŸèƒ½éªŒè¯é€šè¿‡

### 3.2 å®Œæ•´å¯¹æ¯”æµ‹è¯• â³

**çŠ¶æ€**: æ­£åœ¨è¿è¡Œä¸­ï¼ˆåå°ï¼‰

**é…ç½®**:
- æ•°æ®æ–‡ä»¶: `/home/cx/trading_data/training_data_from_klines_20260123_105108.csv`
- åºåˆ—é•¿åº¦: 10
- è®­ç»ƒè½®æ¬¡: 20ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
- æ¨¡å‹: LSTM å’Œ Transformer

**é¢„è®¡æ—¶é—´**: 5-10åˆ†é’Ÿ

---

## ğŸ¯ å››ã€é¢„æœŸç»“æœ

### 4.1 å¯¹æ¯”æŒ‡æ ‡

1. **ä¼ ç»Ÿå‡†ç¡®ç‡**: é¢„æµ‹åŠ¨ä½œ == æ ‡ç­¾
2. **æ”¶ç›ŠåŠ æƒå‡†ç¡®ç‡**: `predicted_profit / best_profit`ï¼ˆæ›´å…³é”®ï¼‰
3. **å‚æ•°é‡**: æ¨¡å‹å¤§å°
4. **è®­ç»ƒæ—¶é—´**: è®­ç»ƒè€—æ—¶

### 4.2 ç†è®ºéªŒè¯

**å¦‚æœTransformerçœŸçš„æ›´å¥½**:
- æ”¶ç›ŠåŠ æƒå‡†ç¡®ç‡åº”è¯¥æ›´é«˜
- ä½†å¯èƒ½éœ€è¦æ›´å¤šè®­ç»ƒæ—¶é—´

**å¦‚æœLSTMæ›´å¥½**:
- å¯èƒ½æ˜¯æ•°æ®é‡ä¸è¶³
- æˆ–åºåˆ—é•¿åº¦å¤ªçŸ­

---

## ğŸ“ äº”ã€ç›‘æ§æµ‹è¯•è¿›åº¦

### 5.1 æŸ¥çœ‹æµ‹è¯•æ—¥å¿—

```bash
tail -f /tmp/fair_comparison_full.log
```

### 5.2 æŸ¥çœ‹æµ‹è¯•ç»“æœ

æµ‹è¯•å®Œæˆåï¼Œç»“æœä¼šä¿å­˜åˆ°ï¼š
- `/home/cx/tigertrade/docs/fair_comparison_results_*.json`

---

## âœ… å…­ã€æ€»ç»“

### 6.1 å·²ä¿®å¤

1. âœ… Transformerè®­ç»ƒæ•°æ®é‡ä¸è¶³é—®é¢˜
2. âœ… Transformeræ•°æ®å‡†å¤‡æ–¹å¼ï¼ˆä½¿ç”¨åºåˆ—ç‰¹å¾ï¼‰
3. âœ… Transformerè®­ç»ƒé…ç½®ï¼ˆæ—©åœã€å­¦ä¹ ç‡è°ƒåº¦ï¼‰
4. âœ… è¾“å…¥ç»´åº¦é”™è¯¯

### 6.2 æ­£åœ¨è¿è¡Œ

1. â³ å®Œæ•´å…¬å¹³å¯¹æ¯”æµ‹è¯•ï¼ˆåå°è¿è¡Œï¼‰

### 6.3 æ ¸å¿ƒæ”¹è¿›

- **è®­ç»ƒ**: æ›´å®Œå–„çš„è®­ç»ƒé€»è¾‘ï¼ˆLSTMå’ŒTransformerç»Ÿä¸€ï¼‰
- **è¯„ä¼°**: æ›´å‡†ç¡®çš„è¯„ä¼°æŒ‡æ ‡ï¼ˆæ”¶ç›ŠåŠ æƒå‡†ç¡®ç‡ï¼‰
- **å¯¹æ¯”**: å…¬å¹³çš„æ¨¡å‹å¯¹æ¯”æ¡†æ¶

---

**çŠ¶æ€**: æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼Œå®Œæ•´å¯¹æ¯”æµ‹è¯•æ­£åœ¨è¿è¡Œ
