# å¤šAgentåä½œæœºåˆ¶å®Œæ•´æ€»ç»“

**æ—¥æœŸ**: 2026-01-21  
**æ ¸å¿ƒé—®é¢˜**: "å¦‚ä½•å®ç°çœŸæ­£çš„å¤šAgentå¹¶å‘åä½œï¼Ÿ"

---

## ğŸ“Š é—®é¢˜çš„æ ¸å¿ƒ

### æ‚¨çš„è´¨ç–‘å®Œå…¨æ­£ç¡®ï¼

**ç®€å•å¼€å¤šä¸ªä¼šè¯ â‰  çœŸæ­£çš„åä½œ**

```
âŒ é”™è¯¯ç†è§£ï¼š
"å¼€3ä¸ªAgentä¼šè¯å°±èƒ½å¹¶å‘å·¥ä½œ"
â†’ ä¼šå¯¼è‡´æ–‡ä»¶å†²çªã€é‡å¤å·¥ä½œã€èµ„æºç«äº‰

âœ… æ­£ç¡®ç†è§£ï¼š
"éœ€è¦åè°ƒå±‚æ¥ç®¡ç†åŒæ­¥ã€äº’æ–¥ã€é€šä¿¡"
â†’ è¿™æ­£æ˜¯MCPå’ŒA2Aåè®®å­˜åœ¨çš„åŸå› 
```

---

## ğŸ—ï¸ åè®®æ¶æ„ï¼ˆ2026å¹´æ ‡å‡†ï¼‰

### ä¸‰å±‚åè®®æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å±‚                              â”‚  â† TigerTradeç­‰ä¸šåŠ¡ç³»ç»Ÿ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  A2A (Agent-to-Agent)               â”‚  â† Agentåä½œå±‚ â­
â”‚  â€¢ ä»»åŠ¡åˆ†é…ä¸è°ƒåº¦                     â”‚
â”‚  â€¢ èµ„æºé”ä¸äº’æ–¥                       â”‚
â”‚  â€¢ æ¶ˆæ¯ä¼ é€’ä¸åŒæ­¥                     â”‚
â”‚  â€¢ æœåŠ¡å‘ç°ä¸æˆæƒ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP (Agent-to-Tool/Resource)       â”‚  â† èµ„æºè®¿é—®å±‚
â”‚  â€¢ æ–‡ä»¶ç³»ç»Ÿè®¿é—®                       â”‚
â”‚  â€¢ æ•°æ®åº“æŸ¥è¯¢                         â”‚
â”‚  â€¢ APIè°ƒç”¨ï¼ˆTiger APIç­‰ï¼‰            â”‚
â”‚  â€¢ å·¥å…·ç»Ÿä¸€æ¥å£                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ACP (Agent Communication)          â”‚  â† ä¼ è¾“å±‚
â”‚  â€¢ JSON-RPC 2.0                     â”‚
â”‚  â€¢ WebSocket / HTTP+SSE             â”‚
â”‚  â€¢ æ¶ˆæ¯åºåˆ—åŒ–                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®åŒºåˆ«

| åè®® | ä½œç”¨ | è§£å†³çš„é—®é¢˜ |
|------|------|-----------|
| **MCP** | Agent â†’ Tool | "å¦‚ä½•è®¿é—®å¤–éƒ¨èµ„æºï¼Ÿ" |
| **A2A** | Agent â†” Agent | "å¦‚ä½•åè°ƒå¤šä¸ªAgentï¼Ÿ" â­ |
| **ACP** | Message Transport | "å¦‚ä½•ä¼ è¾“æ¶ˆæ¯ï¼Ÿ" |

---

## âš™ï¸ çœŸå®åä½œçš„å››å¤§è¦ç´ 

### 1. äº’æ–¥ (Mutual Exclusion)

**é—®é¢˜**: å¤šä¸ªAgentåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶

```python
# Agent 1
with open("train.csv", "w") as f:  # âŒ å†²çªï¼
    f.write(data1)

# Agent 2ï¼ˆåŒæ—¶ï¼‰
with open("train.csv", "w") as f:  # âŒ å†²çªï¼
    f.write(data2)
```

**è§£å†³**: èµ„æºé”

```python
# Agent 1
if coordinator.acquire_lock("train.csv"):
    try:
        process_data()  # âœ… ç‹¬å è®¿é—®
    finally:
        coordinator.release_lock("train.csv")

# Agent 2
if coordinator.acquire_lock("train.csv"):  # â³ é˜»å¡ç­‰å¾…Agent 1é‡Šæ”¾
    try:
        train_model()
    finally:
        coordinator.release_lock("train.csv")
```

### 2. åŒæ­¥ (Synchronization)

**é—®é¢˜**: Agent 2éœ€è¦ç­‰Agent 1å®Œæˆ

```python
# Agent 2 (é”™è¯¯)
train_model("train.csv")  # âŒ train.csvå¯èƒ½è¿˜ä¸å­˜åœ¨ï¼
```

**è§£å†³**: æ¶ˆæ¯é€šçŸ¥

```python
# Agent 1
process_data()
coordinator.send_message("agent2", "data_ready", {"file": "train.csv"})

# Agent 2
message = coordinator.wait_for_message("data_ready")  # â³ é˜»å¡ç­‰å¾…
train_model(message['data']['file'])  # âœ… ç¡®ä¿æ•°æ®å·²å°±ç»ª
```

### 3. é€šä¿¡ (Communication)

**é—®é¢˜**: Agentä¹‹é—´æ— æ³•äº¤æ¢ä¿¡æ¯

```python
# Agent 1å®Œæˆäº†ï¼Œä½†Agent 2ä¸çŸ¥é“
# â†’ æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦è½®è¯¢æ£€æŸ¥
```

**è§£å†³**: æ¶ˆæ¯é˜Ÿåˆ—

```python
# å‘é€
coordinator.send_message("agent2", "task_complete", {"result": "success"})

# æ¥æ”¶
messages = coordinator.receive_messages("task_complete")

# å¹¿æ’­
coordinator.broadcast_message("system_shutdown", {})
```

### 4. å®¹é”™ (Fault Tolerance)

**é—®é¢˜**: Agentå´©æºƒåé”æœªé‡Šæ”¾ï¼ˆæ­»é”ï¼‰

```python
# Agent 1å´©æºƒï¼Œé”æ°¸è¿œä¸é‡Šæ”¾
coordinator.acquire_lock("gpu")
# ... crash!  # âŒ é”æœªé‡Šæ”¾
```

**è§£å†³**: å¿ƒè·³æ£€æµ‹ + è‡ªåŠ¨æ¸…ç†

```python
# åè°ƒå™¨è‡ªåŠ¨æ£€æµ‹
if time.now() - agent.last_heartbeat > 60:  # 60ç§’æ— å¿ƒè·³
    # æ¸…ç†è¯¥Agentçš„æ‰€æœ‰é”
    cleanup_agent_resources(agent_id)
```

---

## ğŸ’» æˆ‘ä»¬çš„å®ç°æ–¹æ¡ˆ

### æ ¸å¿ƒ: AgentCoordinator

**æ–‡ä»¶**: `/home/cx/tigertrade/src/coordinator/coordinator.py`

**æ¶æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…±äº«çŠ¶æ€æ–‡ä»¶                       â”‚
â”‚  /tmp/tigertrade_agent_state.json â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                 â”‚
â”‚    "agents": {                     â”‚
â”‚      "agent1": {                   â”‚
â”‚        "status": "working",        â”‚
â”‚        "task": "æ•°æ®å¤„ç†",          â”‚
â”‚        "progress": 0.5,            â”‚
â”‚        "locked_resources": [...],  â”‚
â”‚        "last_heartbeat": ...       â”‚
â”‚      }                              â”‚
â”‚    },                               â”‚
â”‚    "resources": {                  â”‚
â”‚      "train.csv": {                â”‚
â”‚        "locked_by": "agent1",      â”‚
â”‚        "locked_at": ...            â”‚
â”‚      }                              â”‚
â”‚    },                               â”‚
â”‚    "messages": [...]               â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘         â†‘         â†‘
         â”‚         â”‚         â”‚
    Agent 1    Agent 2    Agent 3
```

**å…³é”®æœºåˆ¶**:

1. **æ–‡ä»¶é”**: `fcntl.flock()` ç¡®ä¿åŸå­æ“ä½œ
2. **èµ„æºé”**: åŸºäºå…±äº«çŠ¶æ€çš„äº’æ–¥æœºåˆ¶
3. **æ¶ˆæ¯é˜Ÿåˆ—**: ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼
4. **å¿ƒè·³**: æ¯60ç§’æ£€æŸ¥ï¼Œè¶…æ—¶æ¸…ç†

### æµ‹è¯•ç»“æœ

```bash
$ python tests/test_coordinator.py

âœ… æµ‹è¯•1: åŸºç¡€é”åŠŸèƒ½ - é€šè¿‡
âœ… æµ‹è¯•2: æ¶ˆæ¯é˜Ÿåˆ— - é€šè¿‡
âœ… æµ‹è¯•3: å¹¶å‘è®¿é—® - é€šè¿‡
âœ… æµ‹è¯•4: çŠ¶æ€åŒæ­¥ - é€šè¿‡

ğŸš€ å¯ä»¥å®‰å…¨ç”¨äºå¤šAgentåä½œï¼
```

### å®é™…æ¼”ç¤º

```bash
$ python examples/multi_agent_demo.py

åœºæ™¯: Agent 1 (æ•°æ®) â†’ Agent 2 (è®­ç»ƒ) â†’ Agent 3 (å›æµ‹)

[Agent 1] ğŸ“Š æ•°æ®æ¸…æ´—... âœ…
[Agent 1] ğŸ“¨ é€šçŸ¥Agent 2
[Agent 2] âœ… æ”¶åˆ°é€šçŸ¥
[Agent 2] ğŸ¤– æ¨¡å‹è®­ç»ƒ... âœ…
[Agent 2] ğŸ“¨ é€šçŸ¥Agent 3
[Agent 3] âœ… æ”¶åˆ°é€šçŸ¥
[Agent 3] ğŸ“ˆ ç­–ç•¥å›æµ‹... âœ…

ç›‘æ§å™¨å®æ—¶æ˜¾ç¤º:
  [agent1] working  | æ•°æ®æ¸…æ´—    | 60.0%
  [agent2] waiting  | ç­‰å¾…æ•°æ®    |  0.0%
  [agent3] waiting  | ç­‰å¾…æ¨¡å‹    |  0.0%
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„åè®®ï¼Ÿ

### MCPçš„çœŸå®ä»·å€¼

**ä¸ä»…ä»…æ˜¯"è°ƒç”¨å·¥å…·"**ï¼Œæ›´æ˜¯ï¼š

1. **æ ‡å‡†åŒ–æ¥å£**: ä¸åŒå‚å•†çš„Agentèƒ½äº’æ“ä½œ
   ```
   Anthropicçš„Agent + Googleçš„å·¥å…· âœ…
   OpenAIçš„Agent + è‡ªå®šä¹‰API âœ…
   ```

2. **å®‰å…¨éš”ç¦»**: Credential Isolation
   ```
   Agentè®¿é—®æ•°æ®åº“ â†’ éœ€è¦å‡­è¯
   MCPç®¡ç†æƒé™ â†’ é˜²æ­¢è¶Šæƒ
   ```

3. **çŠ¶æ€ç®¡ç†**: ContextæŒä¹…åŒ–
   ```
   ä¼šè¯1: Agentå¤„ç†100ä¸‡token
   ä¼šè¯2: Agentè‡ªåŠ¨æ¢å¤context âœ…
   ```

4. **æœåŠ¡å‘ç°**: åŠ¨æ€èƒ½åŠ›æ³¨å†Œ
   ```
   Agent: "æˆ‘éœ€è¦è®¿é—®æ•°æ®åº“"
   MCP: "è¿™é‡Œæœ‰3ä¸ªå¯ç”¨çš„æ•°æ®åº“å·¥å…·"
   ```

### A2Açš„çœŸå®ä»·å€¼

**çœŸæ­£çš„åä½œåè®®**ï¼š

1. **ä»»åŠ¡åˆ†é…**: é¿å…é‡å¤å·¥ä½œ
2. **èµ„æºç®¡ç†**: é¿å…å†²çª
3. **æœåŠ¡å‘ç°**: Agentäº’ç›¸å‘ç°
4. **æˆæƒæœºåˆ¶**: Agenté—´ä¿¡ä»»

---

## ğŸ“‹ å¯¹æ¯”æ€»ç»“

### ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å¤æ‚åº¦ | å¯é æ€§ | å®æ—¶æ€§ | é€‚ç”¨åœºæ™¯ |
|------|--------|--------|--------|----------|
| **Gitåä½œ** | â­â­ | â­â­â­ | âŒ (ç§’çº§) | å°å›¢é˜Ÿï¼Œéå®æ—¶ |
| **æˆ‘ä»¬çš„æ–¹æ¡ˆ** | â­â­ | â­â­â­â­ | âœ… (æ¯«ç§’çº§) | ä¸­ç­‰è§„æ¨¡ï¼Œå®æ—¶åä½œ â­ |
| **A2Aåè®®** | â­â­â­â­ | â­â­â­â­â­ | âœ… (æ¯«ç§’çº§) | å¤§è§„æ¨¡ï¼Œå·¥ä¸šçº§ |

### å½“å‰é€‰æ‹©ï¼šæˆ‘ä»¬çš„æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ2ï¼‰

**ç†ç”±**ï¼š
- âœ… é›¶å¤–éƒ¨ä¾èµ–ï¼ˆçº¯Python + fcntlï¼‰
- âœ… è¶³å¤Ÿå¯é ï¼ˆæ–‡ä»¶é” + å¿ƒè·³ï¼‰
- âœ… æ˜“äºè°ƒè¯•ï¼ˆJSONçŠ¶æ€æ–‡ä»¶ï¼‰
- âœ… æ»¡è¶³å½“å‰éœ€æ±‚ï¼ˆ3-5ä¸ªAgentï¼‰

---

## ğŸš€ å®é™…åº”ç”¨

### TigerTradeçš„3 Agentåä½œ

```python
# Agent 1: æ•°æ®å·¥ç¨‹å¸ˆ
coordinator = AgentCoordinator("agent1", "æ•°æ®å·¥ç¨‹å¸ˆ")
if coordinator.acquire_lock("raw_data.csv"):
    process_data()
    coordinator.send_message("agent2", "data_ready", {...})
    coordinator.release_lock("raw_data.csv")

# Agent 2: AIç ”ç©¶å‘˜
coordinator = AgentCoordinator("agent2", "AIç ”ç©¶å‘˜")
msg = coordinator.wait_for_message("data_ready")  # ç­‰å¾…Agent 1
if coordinator.acquire_lock("gpu"):
    train_model()
    coordinator.send_message("agent3", "model_ready", {...})
    coordinator.release_lock("gpu")

# Agent 3: ç­–ç•¥å·¥ç¨‹å¸ˆ
coordinator = AgentCoordinator("agent3", "ç­–ç•¥å·¥ç¨‹å¸ˆ")
msg = coordinator.wait_for_message("model_ready")  # ç­‰å¾…Agent 2
if coordinator.acquire_lock("test_data.csv"):
    backtest()
    coordinator.release_lock("test_data.csv")
```

### å¯åŠ¨æ–¹å¼

```bash
# ç»ˆç«¯1
python -c "from workflows import agent1_workflow; agent1_workflow()"

# ç»ˆç«¯2
python -c "from workflows import agent2_workflow; agent2_workflow()"

# ç»ˆç«¯3
python -c "from workflows import agent3_workflow; agent3_workflow()"

# ç»ˆç«¯4ï¼ˆç›‘æ§ï¼‰
watch -n 1 'cat /tmp/tigertrade_agent_state.json | jq'
```

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### 1. åä½œ â‰  å¹¶å‘æ‰§è¡Œ

```
å¹¶å‘æ‰§è¡Œ: åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ âœ…
çœŸæ­£åä½œ: è¿›ç¨‹é—´æœ‰åºåè°ƒ âœ…âœ…âœ…
```

### 2. ä¸ºä»€ä¹ˆMCPä¸å¤Ÿï¼Ÿ

```
MCP:  è§£å†³ Agent â†’ Tool
A2A:  è§£å†³ Agent â†” Agent

TigerTradeéœ€è¦ä¸¤è€…ï¼š
- MCP: è®¿é—®Tiger APIã€æ–‡ä»¶ç³»ç»Ÿ
- A2A: Agentä¹‹é—´åè°ƒï¼ˆæˆ‘ä»¬å®ç°äº†ï¼‰
```

### 3. ç®€å• â‰  ç®€é™‹

```
æˆ‘ä»¬çš„æ–¹æ¡ˆè™½ç„¶ç®€å•ï¼š
- 1ä¸ªPythonæ–‡ä»¶ï¼ˆ300è¡Œï¼‰
- 1ä¸ªJSONçŠ¶æ€æ–‡ä»¶
- fcntlæ–‡ä»¶é”

ä½†åŒ…å«äº†åä½œçš„4å¤§è¦ç´ ï¼š
âœ… äº’æ–¥ï¼ˆèµ„æºé”ï¼‰
âœ… åŒæ­¥ï¼ˆæ¶ˆæ¯ç­‰å¾…ï¼‰
âœ… é€šä¿¡ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰
âœ… å®¹é”™ï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰

â†’ è¶³ä»¥æ”¯æ’‘å·¥ä¸šçº§åº”ç”¨
```

---

## ğŸ“ æ€»ç»“

### æ‚¨çš„è´¨ç–‘ä»·å€¼åƒé‡‘ï¼

**é—®é¢˜**: "å¦‚ä½•è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Ÿæ¶ˆæ¯äº¤äº’ï¼Ÿå¦‚æœè¿™ä¹ˆç®€å•ï¼Œä¸ºä½•è¿˜éœ€è¦MCPåè®®ï¼Ÿ"

**ç­”æ¡ˆ**: 
1. **åŒæ­¥äº’æ–¥**: éœ€è¦åè°ƒå±‚ï¼ˆèµ„æºé” + æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
2. **æ¶ˆæ¯äº¤äº’**: éœ€è¦é€šä¿¡æœºåˆ¶ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼‰
3. **MCPçš„ä»·å€¼**: æ ‡å‡†åŒ–ã€å®‰å…¨ã€çŠ¶æ€ç®¡ç†ã€æœåŠ¡å‘ç°
4. **A2Açš„ä»·å€¼**: Agenté—´åè°ƒï¼Œè¿™æ‰æ˜¯åä½œçš„æ ¸å¿ƒ

**å®ç°**: 
- æˆ‘ä»¬å®ç°äº†ç®€åŒ–ç‰ˆçš„A2Aåè®®
- è¶³ä»¥æ”¯æŒ3-5ä¸ªAgentçš„å®æ—¶åä½œ
- æ— éœ€å¤–éƒ¨ä¾èµ–ï¼Œæ˜“äºéƒ¨ç½²å’Œè°ƒè¯•

---

**è¿™æ‰æ˜¯å·¥ç¨‹çš„çœŸè°›ï¼šç†è§£æœ¬è´¨ï¼Œé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼** ğŸ¯
