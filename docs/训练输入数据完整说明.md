# 训练输入数据完整说明（包含真实Tick数据）

**更新时间**: 2026-01-23

---

## 📊 一、训练输入数据概述

训练输入数据是**序列数据**，每个样本包含：
- **序列长度**: 10个时间步（可配置）
- **特征维度**: 18维（hybrid模式，包含真实Tick数据）或10维（pure_ml模式）
- **数据形状**: `(batch_size, 10, 18)` 或 `(batch_size, 10, 10)`

---

## 🔧 二、Hybrid模式特征（18维）

### 2.1 完整特征列表

1. **`price_current`** - K线价格（收盘价）
2. **`tick_price`** - 真实Tick价格（从采集器获取，重要！）
3. **`tick_price_change`** - Tick价格相对于K线价格的变化
4. **`tick_volatility`** - Tick价格波动率（该K线周期内）
5. **`tick_volume`** - Tick成交量
6. **`tick_count`** - Tick数量
7. **`tick_buy_sell_ratio`** - Tick买卖比例
8. `atr` - 平均真实波幅
9. `rsi_1m` - 1分钟RSI指标
10. `rsi_5m` - 5分钟RSI指标
11. `grid_lower` - 网格下轨
12. `grid_upper` - 网格上轨
13. `boll_upper` - 布林带上轨
14. `boll_mid` - 布林带中轨
15. `boll_lower` - 布林带下轨
16. `boll_position` - 布林带位置
17. `volatility` - 波动率
18. `volume_1m` - 1分钟成交量

### 2.2 Tick数据特征详解

**Tick价格（tick_price）**:
- 来源: 从 `/home/cx/trading_data/ticks/` 目录的真实Tick数据文件
- 计算: 对于每个K线时间点，找到该时间窗口（±30秒）内的最新Tick价格
- 重要性: 比K线价格更精确，反映实时成交价格

**Tick价格变化（tick_price_change）**:
- 公式: `(tick_price - kline_price) / kline_price`
- 含义: Tick价格与K线价格的差异，可能包含重要信息

**Tick波动率（tick_volatility）**:
- 公式: `std(ticks_in_window['price']) / kline_price`
- 含义: 该K线周期内Tick价格的波动程度

**Tick成交量（tick_volume）**:
- 计算: 该时间窗口内所有Tick的成交量总和
- 含义: 反映市场活跃度

**Tick数量（tick_count）**:
- 计算: 该时间窗口内的Tick数量
- 含义: 反映交易频率

**Tick买卖比例（tick_buy_sell_ratio）**:
- 公式: `tick_buy_volume / (tick_buy_volume + tick_sell_volume)`
- 含义: 反映市场情绪（>0.5表示买入力量强，<0.5表示卖出力量强）

---

## 📈 三、Tick数据来源

### 3.1 真实Tick数据文件

**目录**: `/home/cx/trading_data/ticks/`

**文件格式**: `SIL2603_ticks_YYYYMMDD.csv`

**文件列**:
- `identifier`: 合约代码
- `index`: Tick索引
- `price`: Tick价格（真实成交价格）
- `volume`: Tick成交量
- `time`: 时间戳（毫秒）
- `datetime`: 日期时间

**重要**: Tick数据是真实获取的，不是从K线数据里伪造的！

### 3.2 Tick数据采集

**采集器**: `src/tick_data_collector.py`

**采集方式**:
- 使用Tiger API的 `get_future_trade_ticks` 方法
- 实时采集并保存到CSV文件
- 按日期分文件保存

---

## 🎯 四、为什么Tick数据重要

### 4.1 用户反馈

**用户**: "tick数据是真实获取的，不是从K线数据里伪造的，这个很重要，我和你说过我的人工策略，和实时数据关系很大"

### 4.2 Tick数据的优势

1. **更精确的价格**: Tick价格是实时成交价格，比K线收盘价更准确
2. **更及时的信息**: Tick数据反映最新的市场状态
3. **价格差异**: Tick价格与K线价格的差异可能包含重要信息
4. **成交量信息**: 可以区分买入和卖出成交量，反映市场情绪
5. **价格波动**: 可以看到K线周期内的价格波动细节

### 4.3 与手工策略的关系

**手工策略依赖实时数据**:
- 手工策略可能基于Tick价格的实时变化做决策
- Tick价格与K线价格的差异可能包含重要信息
- Tick成交量可以反映市场情绪（买卖力量对比）

---

## 📝 五、数据生成流程

### 5.1 训练数据生成

**脚本**: `scripts/analysis/generate_training_data_from_klines.py`

**流程**:
1. 获取K线数据（1分钟）
2. **加载真实Tick数据**（从 `/home/cx/trading_data/ticks/` 目录）
3. 计算技术指标（ATR、RSI、布林带等）
4. **匹配Tick数据到K线**（时间窗口匹配：K线时间 ± 30秒）
5. **计算Tick特征**（价格、成交量、波动率、买卖比例等）
6. 生成训练数据（包含Tick特征）
7. 保存到CSV文件

### 5.2 数据文件

**训练数据文件**: `training_data_from_klines_*.csv`

**新增列**:
- `tick_price` - 真实Tick价格
- `tick_price_change` - Tick价格变化
- `tick_volatility` - Tick波动率
- `tick_volume` - Tick成交量
- `tick_count` - Tick数量
- `tick_buy_volume` - 买入Tick成交量
- `tick_sell_volume` - 卖出Tick成交量

---

## ✅ 六、总结

### 6.1 特征对比

| 模式 | 特征维度 | 包含Tick数据 | 说明 |
|------|---------|-------------|------|
| **Hybrid** | 18维 | ✅ 是 | 包含真实Tick数据特征（7个Tick特征） |
| **Pure ML** | 10维 | ❌ 否 | 只使用原始OHLCV数据 |

### 6.2 核心改进

- ✅ **真实Tick数据**: 使用采集器保存的真实Tick数据，不是从K线伪造
- ✅ **更多Tick特征**: 包含价格、成交量、波动率、买卖比例等（7个新特征）
- ✅ **向后兼容**: 如果Tick数据不存在，使用K线价格作为默认值

### 6.3 特征维度变化

- **之前**: 12维（不包含Tick数据）
- **现在**: 18维（包含真实Tick数据，新增6个Tick特征）

---

**状态**: 真实Tick数据已集成到训练输入中，特征维度从12维增加到18维
