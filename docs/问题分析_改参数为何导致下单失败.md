# 问题分析：为什么改参数会导致下单失败？

## 用户问题

**用户操作**：只修改了风控参数（SINGLE_TRADE_LOSS从1000改为3000）

**实际结果**：下单失败，错误信息：`AttributeError: LIMIT`

**用户质疑**：
1. 改参数之前下单代码是OK的
2. 只改了个参数，下单涉及的代码到底改了没有？
3. 如果没改，为何出错？

---

## 代码检查结果

### 1. 下单代码检查

**tiger1.py 第1404行**：
```python
order_type = OrderType.LMT  # 限价单
```

**OrderType导入**（第25行）：
```python
from tigeropen.common.consts import OrderStatus, OrderType, Currency
```

**实际测试**：
```bash
$ python3 -c "from tigeropen.common.consts import OrderType; print(dir(OrderType))"
['AL', 'AM', 'LMT', 'MKT', 'OCA', 'STP', 'STP_LMT', 'TRAIL', 'TWAP', 'VWAP', ...]

$ python3 -c "from tigeropen.common.consts import OrderType; print(OrderType.LIMIT)"
AttributeError: type object 'OrderType' has no attribute 'LIMIT'
```

**结论**：
- ✅ OrderType有`LMT`属性（代码使用的是正确的）
- ❌ OrderType**没有**`LIMIT`属性（错误信息提到的是LIMIT）

---

## 问题分析

### 关键发现

**错误信息是`AttributeError: LIMIT`，但代码使用的是`OrderType.LMT`**

这说明：
1. **下单代码本身没有改**（使用的是正确的`OrderType.LMT`）
2. **错误信息提到的是`LIMIT`**，说明可能有其他地方使用了`OrderType.LIMIT`

### 可能的原因

#### 原因1：代码中有其他地方使用了`OrderType.LIMIT`

让我检查是否有遗留代码使用了`OrderType.LIMIT`：

```bash
$ grep -r "OrderType.LIMIT" /home/cx/tigertrade/src
# 结果：tiger1_legacy.py中有使用OrderType.LIMIT
```

**发现**：`tiger1_legacy.py`第1154行使用了`OrderType.LIMIT`，但这是旧文件。

#### 原因2：模块重新加载导致导入问题

**可能的情况**：
1. 修改参数后，Python模块被重新加载
2. 重新加载时，`OrderType`导入失败或导入不完整
3. 导致`OrderType.LMT`访问失败

#### 原因3：实际使用的是旧代码路径

**可能的情况**：
1. 虽然`OrderExecutor`已经重构，但实际运行时可能调用了`tiger1.place_tiger_order`
2. 或者有旧代码路径仍然在使用`OrderType.LIMIT`

---

## 需要确认的信息

### 1. 实际错误堆栈

**需要查看**：
- 完整的错误堆栈信息
- 错误发生在哪一行代码
- 是`OrderType.LMT`还是`OrderType.LIMIT`导致的错误

### 2. 实际调用的代码路径

**需要确认**：
- 下单时实际调用的是`OrderExecutor.execute_buy`还是`tiger1.place_tiger_order`
- 如果是`OrderExecutor`，为什么会出现`LIMIT`错误（因为`OrderExecutor`使用的是`OrderType.LMT`）

### 3. 模块加载状态

**需要检查**：
- 修改参数后，模块是否被重新加载
- `OrderType`导入是否成功
- 是否有导入缓存问题

---

## 结论

### 如果下单代码真的没改

**那么问题可能是**：
1. **模块重新加载问题**：修改参数导致模块重新加载，`OrderType`导入失败
2. **代码路径问题**：实际运行的是旧代码路径，使用了`OrderType.LIMIT`
3. **导入缓存问题**：Python的导入缓存导致`OrderType`状态不一致

### 如果下单代码被改了

**那么问题可能是**：
1. 在修复其他问题时，误改了下单代码
2. 代码中有条件分支，参数修改触发了不同的代码路径

---

## 下一步

**需要用户提供**：
1. 完整的错误堆栈信息
2. 确认实际调用的是哪个函数（`OrderExecutor.execute_buy`还是`tiger1.place_tiger_order`）
3. 确认修改参数时，是否同时修改了其他代码
