# 并发通信与任务执行系统

## 概述

并发通信与任务执行系统允许同时进行与其他agent的通信和执行交易任务，实现了真正的并发处理能力。

## 系统特性

### 1. 线程化设计
- **通信线程**：负责与其他agent通信，包括向master发送状态报告和检查消息
- **执行线程**：负责执行交易策略，独立于通信任务运行
- **主线程**：监控整个系统状态并处理中断信号

### 2. 并发能力
- 通信和任务执行同时进行，互不干扰
- 使用线程事件控制优雅的关闭过程
- 线程安全的系统设计

### 3. 通信功能
- 定期向master发送状态报告（每5秒）
- 检查来自其他agent的消息（每3秒）
- 遵循多AGENT协作架构规范

### 4. 任务执行功能
- 运行双向交易策略（每10秒执行一次）
- 支持做多和做空操作
- 包含完整的风险管理机制

## 使用方法

### 运行并发系统
```bash
cd /home/cx/tigertrade
python scripts/threaded_concurrent_system.py
```

### 脚本功能说明
- `threaded_concurrent_system.py`: 主并发系统脚本
- `concurrent_communication_task_execution.py`: 基于asyncio的并发系统（备用方案）

## 实现细节

### 通信线程职责
1. 定期发送状态报告给master
2. 检查来自其他agent的消息
3. 维护与系统的通信连接

### 执行线程职责
1. 执行双向交易策略
2. 监控市场数据和指标
3. 执行交易决策（买入/卖出）
4. 管理持仓和风险管理

### 控制机制
- 使用`threading.Event`控制线程的优雅停止
- 主线程监控子线程状态
- 支持通过Ctrl+C中断整个系统

## 优势

1. **效率提升**：同时处理通信和任务执行，最大化系统利用率
2. **响应性**：保持与其他agent的实时通信，不会因任务执行而延迟
3. **鲁棒性**：独立的线程设计，一个线程的问题不会影响另一个线程
4. **可扩展性**：易于添加更多的并发任务

## 注意事项

- 系统会在接收到中断信号时优雅关闭
- 所有线程都会在主进程结束前正确终止
- 可以根据需要调整各个线程的执行频率