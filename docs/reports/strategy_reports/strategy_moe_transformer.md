# MoE Transformer 策略

*报告生成时间：2026-02-11T10:50:10.915639*

## 📄 设计文档（算法与参数详解）

- **→ [设计_MoE策略](../../strategy_designs/设计_MoE策略.md)** — 算法原理、参数含义、训练流程与实现细节。

## 算法说明

基于混合专家（Mixture of Experts）的 Transformer 时序预测策略。
- **模型**：多专家 Transformer，输入多时间尺度特征（如 46 维），输出方向/收益预测。
- **信号**：结合方向置信度与预测收益，在满足风控条件下发出买入/卖出/观望。
- **训练**：历史 K 线 + 技术指标，预测下一阶段涨跌与收益；支持 LoRA/微调。
- **适用**：DEMO/实盘主推策略之一，适合中短周期趋势与波动。

更完整的说明（模型结构、信号逻辑、训练与回测）请参见上方 **设计文档**：[设计_MoE策略](../../strategy_designs/设计_MoE策略.md)。

## 运行效果

### 回测效果

（回测数据：历史 K 线回测。）

| 指标 | 值 | 说明 |
| --- | --- | --- |
| num_trades | 23 | 回测区间内实际完成的开平仓次数。 |
| return_pct | 1.44 | (期末资金 − 10万) / 10万 × 100（%）。来自 data/processed/test.csv 历史 K 线回测。 |
| avg_per_trade_pct | 0.0 | 总收益/笔数，每笔占初始资金%。 |
| top_per_trade_pct | 0.0 | 单笔最大收益占初始资金%。 |
| win_rate | 100.0 | 盈利笔数 / 完成笔数 × 100（%）。回测表为回测结果；实盘表为实盘胜率，仅来自 API 历史订单解析。 |

### 实盘/DEMO 效果

（实盘数据：实盘胜率、实际收益率（老虎核对）、推算收益率（未核对）、今日展示、DEMO 日志汇总。）

| 指标 | 值 | 说明 |
| --- | --- | --- |
| win_rate | — | 盈利笔数 / 完成笔数 × 100（%）。回测表为回测结果；实盘表为实盘胜率，仅来自 API 历史订单解析。 |
| yield_verified | — | 用老虎后台订单/成交数据计算出的收益率；未拉取或未核对时为 —。 |
| yield_estimated | — | 未与老虎核对时的推算值（如 API 报告解析）；无推算时为 —。 |
| today_yield_pct | — | 本日在状态/报告中展示的收益率，来自 today_yield.json；须以实际（老虎核对）为准。 |
| profitability | 0 | API 历史订单解析得到的总交易数、总盈亏等；无 API 时为 0 或 —。 |
| demo_order_success | 9743 | DEMO 日志中「订单提交成功」等匹配次数（多日志汇总），非老虎后台笔数。 |
| demo_sl_tp_log | 91496 | 日志全文匹配「止损|止盈|已提交止损|已提交止盈」等的出现次数。 |
| demo_execute_buy_calls | 34638 | 日志匹配「execute_buy|动作: 买入」的次数。 |
| demo_success_orders_sum | 330611 | 日志内统计的成功订单数汇总，非老虎后台。 |
| demo_fail_orders_sum | 4375898 | 日志内统计的失败订单数汇总。 |
| demo_logs_scanned | 20 | 参与汇总的 demo_*.log、demo_run_20h_*.log 文件个数。 |

### DEMO 运行统计（多日/多日志汇总）

共扫描 **20** 个 DEMO 日志文件（`demo_*.log`、`demo_run_20h_*.log`），汇总如下。

| 项 | 值 |
| --- | --- |
| 主单成功次数（汇总） | 9743 |
| 成功订单数（日志内统计汇总） | 330611 |
| 失败订单数（日志内统计汇总） | 4375898 |
| 止损/止盈相关日志条数 | 91496 |
| 买入动作/execute_buy 次数 | 34638 |
| 日志总行数 | 8652342 |
| 最大仓位（各日志中出现过的最大值） | 8 手 |

## 每日收益与算法优化在干啥

**每日「收益与算法优化」在干啥**
- **结果分析**：用 API 历史订单算收益率/胜率（若有）；用 DEMO 多日志汇总订单与止损止盈统计；用 today_yield 展示今日收益率。
- **算法优化**：对网格/BOLL 做参数网格回测（需 `data/processed/test.csv`），得到最优参数与回测收益/胜率，写入报告。
- **报告产出**：更新 `algorithm_optimization_report.json`/`.md`、本策略算法与运行效果报告；报告内「效果数据来源」会写明本次用了哪些数据。

**咋干的（步骤）**
1. 加载历史订单（API）→ 若无则收益率为空。
2. 计算收益率（解析订单盈亏）→ 当前未解析时为空。
3. 分析策略表现：汇总所有 DEMO 日志（demo_*.log、demo_run_20h_*.log）→ 主单成功、止损止盈条数等；读 today_yield.json。
4. 优化参数：对 grid、boll 跑网格回测（parameter_grid_search）→ 最优参数与 return_pct、win_rate。
5. 生成算法优化报告（含效果数据来源说明）并调用本脚本刷新策略报告。

**脚本**：`python scripts/optimize_algorithm_and_profitability.py`。详见 `docs/每日例行_效果数据说明.md`。

详见：[每日例行_效果数据说明](../../每日例行_效果数据说明.md)。
