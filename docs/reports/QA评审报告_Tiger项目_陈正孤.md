# TigerTrade 项目 QA 全面评审报告

**评审角色**：陈正孤（项目 QA）  
**评审范围**：需求分析/设计文档、代码、测试用例、报告  
**评审日期**：2026-02-08  
**依据文档**：需求分析和Feature测试设计.md、设计完备性_业界方案与DFX.md、项目质量与自测目标.md、回测与实盘_输入与处理流程对比.md、CI_CD和稳定性测试流程.md，及 tests/、src/、docs/reports/ 抽样

---

## 一、需求与设计文档评审

### 1.1 优点

- **需求结构化清晰**：7 大 Feature（数据采集、策略预测、订单执行、风控、数据提供、交易循环、算法优化）与 AR 验收标准一一对应，可追溯。
- **设计完备性有专门文档**：设计完备性_业界方案与DFX.md 覆盖业界对比、功能/性能分析、DFX（可靠性/可用性/易用性/可服务/可维护/可演进/可测试），并引用实现位置。
- **回测与实盘对齐有专门说明**：回测与实盘_输入与处理流程对比.md 明确「同一套信号、同一套数据粒度、同一套决策节奏」，虚拟时间与 sleep 对应关系清楚。
- **需求与测试设计同文档**：需求分析和Feature测试设计.md 内含 TC-Fx-xxx 与 AR 映射，便于做需求覆盖分析。

### 1.2 问题与建议

| 编号 | 严重程度 | 问题描述 | 建议 |
|------|----------|----------|------|
| **D1** | 高 | **回测与实盘逻辑不一致**：algorithm_optimization_report 与需求文档均指出，grid/boll 回测使用 `parameter_grid_search`（RSI+均线参数网格），实盘使用 `grid_trading_strategy_pro1`（网格上下轨+ATR+RSI+反弹/量能），**不是同一套逻辑**，回测结果对实盘参考意义有限。 | 按设计文档「从目的上对齐」：回测改为调用与实盘同一套规则，或统一使用 `backtest_grid_trading_strategy_pro1`；并在需求/设计文档中明确「回测与实盘必须同逻辑」的验收条件。 |
| **D2** | 中 | **Feature 7（算法改进与优化）验收标准未在测试中显式覆盖**：AR7.1/AR7.2/AR7.3 涉及每日/周期性参数优化、模型超参可配置、大模型搜参设计文档。测试套件中无对应 TC-F7-xxx 或等价用例，无法自动验证「例行中至少包含策略规则参数优化并产出报告」。 | 增加 Feature 7 级测试设计（如 TC-F7-001：例行脚本产出优化报告；TC-F7-002：模型超参可通过配置影响训练），或在 CI/例行检查中显式校验报告产出与设计文档存在。 |
| **D3** | 中 | **20 小时稳定性目标与 CI 执行方式未完全对齐**：CI_CD和稳定性测试流程.md 写明「20 小时稳定性测试」为每日 CI 一环，但 20h 若在 CI 中真实跑满会阻塞流水线；文档未说明是「每日单独调度 20h 任务」还是「CI 中短时冒烟」。 | 在 CI_CD 文档中明确：20h 测试的触发方式（独立 workflow/ cron）、与主 CI 的关系、以及「未跑满 20h 时」的判定规则（如仅标记 warning 不 block 合并）。 |
| **D4** | 低 | **KPI 指标（月盈利率 20%、夏普>2、回撤<10% 等）在文档中未与可测指标/报告字段一一绑定**：需求中有目标值，但未在「每日例行_效果数据说明」或报告模板中明确哪些字段对应哪些 KPI、阈值在何处配置。 | 在需求或效果数据说明中增加「KPI ↔ 报告字段 ↔ 阈值配置」对照表，便于 QA 与例行检查。 |

---

## 二、代码评审

### 2.1 优点

- **核心路径有测试与文档**：订单执行（OrderExecutor）、风控、tiger1 入口、API 适配均有对应测试与订单执行流程说明、Tiger API 约束文档。
- **禁止项在测试中固化**：test_blackbox_demo 中禁止 1010、account 为空、AttributeError、NameError 等，与项目质量与自测目标一致。
- **风控硬顶明确**：DEMO_MAX_POSITION=2，OrderExecutor 与 place_tiger_order 均以「持仓+待成交买单」硬顶，文档与自测流程一致。

### 2.2 问题与建议

| 编号 | 严重程度 | 问题描述 | 建议 |
|------|----------|----------|------|
| **C1** | 中 | **源码中存在 TODO/FIXME 类注释**：如 `src/strategies/transformer_strategy.py` 存在 2 处；未在 ISSUE 或计划中统一跟踪。 | 将遗留 TODO/FIXME 登记到项目计划或 ISSUE，并约定：新增 TODO 必须带 ISSUE 号或截止时间。 |
| **C2** | 低 | **报告生成时间与「今日」语义**：algorithm_optimization_report 等报告使用脚本生成时间作为「生成时间」，若在跨日或定时任务中运行，与「今日收益率」「当日亏损」等业务语义可能不一致。 | 在报告脚本中明确「报告日」与「数据日」的取值规则（如以数据日期为准），并在报告页注明。 |

---

## 三、测试用例评审

### 3.1 优点

- **Feature 与 AR 追溯清晰**：test_feature_order_execution、test_feature_risk_management、test_feature_strategy_prediction、test_feature_data_collection、test_feature_trading_loop 等均标注 TC-Fx-xxx 与 ARx.x，便于覆盖度分析。
- **黑盒与 Feature 分工明确**：黑盒覆盖真实入口与禁止项、后台可见性；Feature 覆盖各 Feature 的 AR；real_api 与 mock 场景分离，CI 可排除 real_api。
- **自测流程文档化**：项目质量与自测目标中给出具体 pytest 命令与覆盖率查看方式，以及 DEMO 清理脚本。

### 3.2 问题与建议

| 编号 | 严重程度 | 问题描述 | 建议 |
|------|----------|----------|------|
| **T1** | 高 | **TC-F6-001（20 小时运行）未自动化**：需求中 AR6.1 要求「系统能够持续运行至少 20 小时不崩溃」；测试设计中 TC-F6-001 为「运行 run_loop(duration_hours=20)」。当前 test_feature_trading_loop 仅做短时运行与异常处理验证，**无真正 20h 自动化用例**。 | 保留 20h 为独立/定时任务；在 CI 或例行中增加「20h 运行结果检查」步骤（如检查 stability_report.md、错误率阈值），并在测试设计文档中注明「TC-F6-001 由稳定性流水线执行」。 |
| **T2** | 中 | **Feature 1 数据去重（AR1.4）验证较弱**：TC-F1-004 仅通过两次获取数据比较条数，未构造明确重复数据场景验证去重逻辑。 | 增加「注入重复 tick/kline 再获取，断言去重后条数」的用例，或在对应用例中注明「当前为弱验证，强验证待补充」。 |
| **T3** | 中 | **部分 Feature 测试依赖 real_api 时 CI 跳过**：real_api 标记用例在无配置时 skip，若长期无人跑 real_api 套件，真实环境回归可能滞后。 | 在项目计划或例行中明确「real_api 套件运行频率与责任人」（如每周/发布前），并在 README 或 TEST_README 中说明。 |
| **T4** | 低 | **测试用例与需求文档的 TC 编号存在多文件分散**：同一 TC-F3-001 在 test_feature_order_execution 与 test_feature_order_execution_real_api 中均有实现，需避免双份维护导致不一致。 | 统一约定：每个 TC 编号仅在一处实现（如 real_api 与 mock 为同一 TC 的不同标记），或在文档中明确「主实现」与「变体」关系。 |

---

## 四、报告评审

### 4.1 优点

- **算法优化报告结构完整**：含效果数据来源、空项根因说明、日志与老虎后台差异、回测与实盘差异说明、回测明细表，便于追溯与排错。
- **空项根因有说明**：明确「推算收益率为空」等是因为 order_log 无每笔平仓价等，避免误读。
- **回测与实盘一致性在报告中单独说明**：有利于暴露「回测与实盘逻辑不一致」问题（与 D1 呼应）。

### 4.2 问题与建议

| 编号 | 严重程度 | 问题描述 | 建议 |
|------|----------|----------|------|
| **R1** | 中 | **报告与需求 KPI 的对应关系未在报告模板中显式列出**：报告中有收益率、胜率、回撤等数据，但未在报告头部或附录中列出「本报告指标 ↔ 需求 KPI（月盈利率 20% 等）」对照。 | 在算法优化报告或 strategy_reports 模板中增加「本报告指标与需求 KPI 对照」小节，便于评审与达标检查。 |
| **R2** | 低 | **多份报告分散（algorithm_optimization_report、strategy_reports、order_log_analysis 等）**：缺少一份「总览报告」或索引，说明各报告用途、更新频率、谁消费。 | 在 docs/reports/ 或 strategy_reports_index 中增加「报告总览与使用说明」，并链接到需求/例行文档。 |

---

## 五、问题汇总与优先级

### 5.1 高优先级（建议本迭代处理）

| 编号 | 摘要 |
|------|------|
| D1 | 回测与实盘逻辑不一致（grid/boll），回测参考价值受限 |
| T1 | TC-F6-001（20h 运行）未自动化，需明确由稳定性流水线执行并检查结果 |

### 5.2 中优先级（计划内或下迭代）

| 编号 | 摘要 |
|------|------|
| D2 | Feature 7 验收标准无对应测试或例行校验 |
| D3 | 20h 稳定性测试与 CI 的触发与判定方式需在文档中明确 |
| C1 | 源码 TODO/FIXME 未统一跟踪 |
| T2 | AR1.4 数据去重验证较弱 |
| T3 | real_api 套件运行频率与责任人需明确 |
| R1 | 报告与需求 KPI 对照未显式列出 |

### 5.3 低优先级（持续改进）

| 编号 | 摘要 |
|------|------|
| D4 | KPI 与报告字段/阈值配置的对照表 |
| C2 | 报告「报告日/数据日」语义 |
| T4 | TC 编号在多文件中主实现与变体关系 |
| R2 | 报告总览与使用说明 |

---

## 六、结论与建议

- **整体**：需求与设计文档齐全、可追溯性好；测试与 AR 映射清晰，黑盒与禁止项到位；报告有根因说明与回测/实盘差异说明。主要风险集中在**回测与实盘逻辑不一致**、**20h 稳定性验证与 CI/例行闭环**、以及 **Feature 7 与部分 AR 的自动化验证不足**。
- **建议**：  
  1. 优先落实 D1（回测与实盘同逻辑）和 T1（20h 由稳定性流水线执行并检查）。  
  2. 在项目计划或 STATUS 中为 D2、D3、T2、T3、R1 安排责任人与时间。  
  3. 将本报告纳入项目评审与例行检视，下次 QA 评审时可针对上述编号做关闭/进展跟踪。

---

*评审人：陈正孤（QA） | 文档位置：docs/reports/QA评审报告_Tiger项目_陈正孤.md*
