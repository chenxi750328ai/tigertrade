# 训练输入数据说明（已更新：包含真实Tick数据）

**更新时间**: 2026-01-23

---

## 📊 一、训练输入数据概述

训练输入数据是**序列数据**，每个样本包含：
- **序列长度**: 10个时间步（可配置）
- **特征维度**: 18维（hybrid模式，包含真实Tick数据）或10维（pure_ml模式）
- **数据形状**: `(batch_size, sequence_length, feature_size)`

---

## 🔧 二、两种模式的特征

### 2.1 计算模式（Hybrid Mode）- 18维（已更新）

**特征维度**: 18维（包含真实Tick数据）

**特征列表**:
1. `price_current` - K线价格
2. **`tick_price`** - 真实Tick价格（重要！从采集器获取）
3. **`tick_price_change`** - Tick价格相对于K线价格的变化
4. **`tick_volatility`** - Tick价格波动率（该K线周期内）
5. **`tick_volume`** - Tick成交量
6. **`tick_count`** - Tick数量
7. **`tick_buy_sell_ratio`** - Tick买卖比例
8. `atr` - 平均真实波幅
9. `rsi_1m` - 1分钟RSI指标
10. `rsi_5m` - 5分钟RSI指标
11. `grid_lower` - 网格下轨
12. `grid_upper` - 网格上轨
13. `boll_upper` - 布林带上轨
14. `boll_mid` - 布林带中轨
15. `boll_lower` - 布林带下轨
16. `boll_position` - 布林带位置
17. `volatility` - 波动率
18. `volume_1m` - 1分钟成交量

**Tick数据来源**:
- ✅ 从 `/home/cx/trading_data/ticks/` 目录加载真实的Tick数据文件
- ✅ 使用Tick采集器（`tick_data_collector.py`）保存的真实数据
- ✅ 不是从K线数据伪造的

**特点**:
- ✅ 包含真实Tick价格（比K线价格更精确）
- ✅ 包含Tick价格变化（反映实时市场状态）
- ✅ 包含Tick波动率（反映价格波动细节）
- ✅ 包含Tick成交量信息（反映市场活跃度）
- ✅ 包含买卖比例（反映市场情绪）

**代码位置**: `llm_strategy.py` 第711-740行

```python
if self.mode == 'hybrid':
    # 获取Tick价格（如果存在）
    tick_price = get_value_safe('tick_price', 0)
    if tick_price == 0:
        tick_price = get_value_safe('price_current', 0)
    
    # Tick相关特征
    tick_price_change = get_value_safe('tick_price_change', 0)
    tick_volatility = get_value_safe('tick_volatility', 0)
    tick_volume = get_value_safe('tick_volume', 0)
    tick_count = get_value_safe('tick_count', 0)
    tick_buy_volume = get_value_safe('tick_buy_volume', 0)
    tick_sell_volume = get_value_safe('tick_sell_volume', 0)
    
    # 计算买卖比例
    tick_buy_sell_ratio = 0.5
    if tick_buy_volume + tick_sell_volume > 0:
        tick_buy_sell_ratio = tick_buy_volume / (tick_buy_volume + tick_sell_volume)
    
    features = [
        get_value_safe('price_current', 0),  # K线价格
        tick_price,  # 真实Tick价格
        tick_price_change,  # Tick价格变化
        tick_volatility,  # Tick波动率
        tick_volume,  # Tick成交量
        tick_count,  # Tick数量
        tick_buy_sell_ratio,  # Tick买卖比例
        # ... 其他特征
    ]
    feature_size = 18
```

---

### 2.2 大模型识别模式（Pure ML Mode）- 10维

**特征维度**: 10维

**特征列表**:
1. `open_1m` - 1分钟开盘价
2. `high_1m` - 1分钟最高价
3. `low_1m` - 1分钟最低价
4. `close_1m` - 1分钟收盘价
5. `volume_1m` - 1分钟成交量
6. `open_5m` - 5分钟开盘价
7. `high_5m` - 5分钟最高价
8. `low_5m` - 5分钟最低价
9. `close_5m` - 5分钟收盘价
10. `volume_5m` - 5分钟成交量

**特点**:
- ✅ 只使用原始OHLCV数据
- ✅ 不包含任何计算好的技术指标
- ✅ 不包含Tick数据（Pure ML模式）

---

## 📈 三、Tick数据详细说明

### 3.1 Tick数据来源

**采集器**: `src/tick_data_collector.py`

**数据文件**: `/home/cx/trading_data/ticks/SIL2603_ticks_YYYYMMDD.csv`

**文件格式**:
```
identifier,index,price,volume,time,datetime
SIL2603,0,92.855,1,1769036400000,2026-01-21 23:00:00
SIL2603,1,92.9,1,1769036400000,2026-01-21 23:00:00
```

**列说明**:
- `identifier`: 合约代码
- `index`: Tick索引
- `price`: Tick价格（真实成交价格）
- `volume`: Tick成交量
- `time`: 时间戳（毫秒）
- `datetime`: 日期时间

### 3.2 Tick特征计算

**Tick价格匹配**:
- 对于每个K线时间点，找到该时间窗口内的Tick数据
- 时间窗口: K线时间 ± 30秒
- 使用最新的Tick价格作为该K线的Tick价格

**Tick特征**:
1. **tick_price**: 最新Tick价格
2. **tick_price_change**: `(tick_price - kline_price) / kline_price`
3. **tick_volatility**: Tick价格在该窗口内的标准差（归一化）
4. **tick_volume**: 该窗口内所有Tick的成交量总和
5. **tick_count**: 该窗口内的Tick数量
6. **tick_buy_volume**: 买入Tick的成交量总和
7. **tick_sell_volume**: 卖出Tick的成交量总和
8. **tick_buy_sell_ratio**: `tick_buy_volume / (tick_buy_volume + tick_sell_volume)`

---

## 🎯 四、为什么Tick数据重要

### 4.1 与手工策略的关系

**用户反馈**: "tick数据是真实获取的，不是从K线数据里伪造的，这个很重要，我和你说过我的人工策略，和实时数据关系很大"

**Tick数据的优势**:
- ✅ **更精确的价格**: Tick价格是实时成交价格，比K线收盘价更准确
- ✅ **更及时的信息**: Tick数据反映最新的市场状态
- ✅ **价格差异**: Tick价格与K线价格的差异可能包含重要信息
- ✅ **成交量信息**: 可以区分买入和卖出成交量，反映市场情绪
- ✅ **价格波动**: 可以看到K线周期内的价格波动细节

### 4.2 实际应用

**手工策略可能依赖**:
- Tick价格的实时变化
- Tick价格与K线价格的差异
- Tick买卖成交量的对比
- Tick价格的波动率

**模型学习**:
- 模型可以学习Tick价格与K线价格的关系
- 模型可以学习Tick成交量对价格的影响
- 模型可以学习Tick波动率对交易决策的影响

---

## 📝 五、数据生成流程

### 5.1 训练数据生成

**脚本**: `scripts/analysis/generate_training_data_from_klines.py`

**流程**:
1. 获取K线数据（1分钟）
2. **加载真实Tick数据**（从 `/home/cx/trading_data/ticks/` 目录）
3. 计算技术指标（ATR、RSI、布林带等）
4. **匹配Tick数据到K线**（时间窗口匹配）
5. **计算Tick特征**（价格、成交量、波动率等）
6. 生成训练数据（包含Tick特征）
7. 保存到CSV文件

### 5.2 数据文件

**训练数据文件**: `training_data_from_klines_*.csv`

**新增列**:
- `tick_price` - 真实Tick价格
- `tick_price_change` - Tick价格变化
- `tick_volatility` - Tick波动率
- `tick_volume` - Tick成交量
- `tick_count` - Tick数量
- `tick_buy_volume` - 买入Tick成交量
- `tick_sell_volume` - 卖出Tick成交量

---

## ✅ 六、总结

### 6.1 特征对比

| 模式 | 特征维度 | 包含Tick数据 | 说明 |
|------|---------|-------------|------|
| **Hybrid** | 18维 | ✅ 是 | 包含真实Tick数据特征 |
| **Pure ML** | 10维 | ❌ 否 | 只使用原始OHLCV数据 |

### 6.2 核心改进

- ✅ **真实Tick数据**: 使用采集器保存的真实Tick数据
- ✅ **更多Tick特征**: 包含价格、成交量、波动率、买卖比例等
- ✅ **向后兼容**: 如果Tick数据不存在，使用K线价格作为默认值

---

**状态**: 训练输入数据已更新，包含真实Tick数据，特征维度从12维增加到18维
