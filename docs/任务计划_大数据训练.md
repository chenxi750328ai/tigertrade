# 大数据获取与策略训练任务计划

**日期**: 2026-01-21  
**目标**: 获取大量真实数据，训练7个策略模型，实现稳定盈利

---

## 📋 任务目标

### 主要目标
1. **数据采集**: 获取足够的真实市场数据（目标>20000条）
2. **模型训练**: 训练并验证7个交易策略模型
3. **盈利验证**: 测试验证，目标实现稳定盈利
4. **合约扩展**: 支持期货合约时间扩展（SIL2603→2604/05/06...）

### 7个交易策略
1. LSTM策略
2. Transformer策略
3. 强化学习策略
4. 其他4个策略（需确认）

---

## ⚠️ 关键约束（从RAG检索）

### 数据采集约束
- ✅ **必须验证API初始化**（禁止Mock数据）
- ✅ **检查程序输出的异常信息**
- ✅ **验证数据质量**（非空、非常量、有效OHLC）

### 训练前检查
- ✅ **特征有效性**（非常量、非零）
- ✅ **标签合理性**（无时间泄漏）
- ✅ **数据分割正确**（时间序列分割，非随机）

---

## 📊 期货合约扩展方案

### 问题
- 当前硬编码：`FUTURE_SYMBOL = 'SIL2603'`
- 期货合约会过期：2603 → 2604 → 2605 → 2606...

### 解决方案

#### 方案1：动态合约选择（推荐）
```python
import datetime

def get_current_futures_contract(base_symbol='SIL'):
    """根据当前日期自动选择最近的期货合约"""
    now = datetime.datetime.now()
    year = now.year % 100  # 26
    month = now.month
    
    # 选择当前月或下月合约
    if now.day > 15:  # 月中后选择下月
        month += 1
    if month > 12:
        month = 1
        year += 1
    
    return f"{base_symbol}{year:02d}{month:02d}"

# 使用
FUTURE_SYMBOL = get_current_futures_contract('SIL')
```

#### 方案2：多合约并行
```python
FUTURE_SYMBOLS = [
    'SIL2603',
    'SIL2604', 
    'SIL2605',
    'SIL2606'
]

# 对每个合约分别采集和训练
for symbol in FUTURE_SYMBOLS:
    collect_data(symbol)
    train_models(symbol)
```

#### 方案3：主力合约追踪
```python
def get_main_contract(base_symbol='SIL'):
    """
    获取主力合约（成交量最大的合约）
    需要通过API查询当前所有合约的成交量
    """
    # 查询API获取所有SIL合约
    contracts = api.get_contracts(base_symbol)
    # 按成交量排序
    main = max(contracts, key=lambda x: x.volume)
    return main.symbol
```

---

## 🔧 实施步骤

### Step 1: 项目状态分析 ✅
- [x] 检查现有代码结构
- [x] 查看历史数据
- [x] 从RAG检索经验教训
- [ ] 确认7个策略模型

### Step 2: 合约扩展支持
- [ ] 实现动态合约选择函数
- [ ] 修改config.py支持合约参数
- [ ] 测试合约切换功能

### Step 3: 大数据采集
- [ ] 验证Tiger API初始化
- [ ] 配置数据采集参数（目标样本数、时间范围）
- [ ] 执行数据采集
- [ ] 实时监控采集过程（检查异常）
- [ ] 验证采集的数据质量

### Step 4: 数据质量检查
- [ ] 检查数据量是否达标
- [ ] 验证特征有效性（非常量）
- [ ] 检查OHLC数据完整性
- [ ] 验证时间序列连续性
- [ ] 检查是否有Mock数据痕迹

### Step 5: 模型训练
- [ ] 确认7个策略模型列表
- [ ] 逐个训练模型
- [ ] 监控训练过程（loss、accuracy）
- [ ] 保存训练日志

### Step 6: 测试验证
- [ ] 在测试集上评估
- [ ] 计算盈利指标
- [ ] 分析策略表现
- [ ] 识别最佳策略

### Step 7: 结果记录
- [ ] 记录训练结果到RAG
- [ ] 记录经验教训
- [ ] 更新项目文档

---

## 📝 检查清单

### 数据采集前
- [ ] API配置文件存在：`/home/cx/openapicfg_demo/`
- [ ] 从RAG检索数据采集规则
- [ ] 确认使用真实API（非Mock）
- [ ] 设置合理的数据量目标

### 数据采集中
- [ ] 实时查看日志输出
- [ ] 检查是否有"模拟模式"、"Mock"关键字
- [ ] 检查是否有异常信息
- [ ] 监控数据采集进度

### 数据采集后
- [ ] 验证数据文件大小
- [ ] 检查数据条数
- [ ] 验证特征值分布
- [ ] 确认无时间泄漏

### 模型训练前
- [ ] 从RAG检索训练规则
- [ ] 确认数据分割方式（时间序列分割）
- [ ] 检查特征和标签
- [ ] 设置合理的超参数

### 模型训练后
- [ ] 检查训练日志
- [ ] 验证准确率合理性（不应过高如>95%）
- [ ] 测试集评估
- [ ] 记录结果

---

## 🎯 成功标准

1. **数据量**: 采集到>20000条真实市场数据
2. **数据质量**: 所有特征有效，无Mock数据
3. **模型数量**: 7个策略全部训练成功
4. **模型性能**: 测试集准确率在合理范围（60-80%）
5. **盈利能力**: 至少1个策略在测试集上实现正收益
6. **合约扩展**: 代码支持动态切换期货合约

---

## 📚 参考资料

- Tiger API文档
- 项目README: `/home/cx/tigertrade/README.md`
- 数据采集脚本: `/home/cx/tigertrade/src/collect_*.py`
- 训练脚本: `/home/cx/tigertrade/src/train_*.py`
- RAG系统: `http://localhost:8000`

---

## 🚨 风险与注意事项

1. **API限流**: Tiger API可能有频率限制，需要合理设置采集间隔
2. **数据完整性**: 节假日、夜盘可能导致数据缺失
3. **过拟合风险**: 训练准确率过高（>95%）可能存在数据泄漏
4. **合约切换**: 不同合约可能有不同的价格范围和波动特性
5. **回测偏差**: 历史数据表现不代表未来收益

---

**创建时间**: 2026-01-21  
**最后更新**: 2026-01-21  
**状态**: 规划中
