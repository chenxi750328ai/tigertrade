#!/bin/bash
# ç›‘æ§æ¨¡å‹è®­ç»ƒè¿›åº¦

LOG_DIR="/home/cx/tigertrade/logs"
LATEST_LOG=$(ls -t $LOG_DIR/training_*.log 2>/dev/null | head -1)

if [ -z "$LATEST_LOG" ]; then
    echo "âŒ æœªæ‰¾åˆ°è®­ç»ƒæ—¥å¿—"
    exit 1
fi

echo "========================================================================"
echo "ğŸ” æ¨¡å‹è®­ç»ƒè¿›åº¦ç›‘æ§"
echo "========================================================================"
echo "æ—¥å¿—æ–‡ä»¶: $LATEST_LOG"
echo ""

# æ£€æŸ¥æ˜¯å¦è¿˜åœ¨è®­ç»ƒ
if ps aux | grep -v grep | grep "train_all_models.py" > /dev/null; then
    echo "âœ… çŠ¶æ€: è®­ç»ƒè¿›è¡Œä¸­"
else
    echo "âš ï¸  çŠ¶æ€: è®­ç»ƒå·²ç»“æŸæˆ–æœªè¿è¡Œ"
fi

echo ""
echo "------------------------------------------------------------------------"
echo "ğŸ“Š æœ€æ–°è®­ç»ƒè¿›åº¦:"
echo "------------------------------------------------------------------------"

# æå–æœ€æ–°çš„epochä¿¡æ¯
tail -100 "$LATEST_LOG" 2>/dev/null | grep -E "Epoch [0-9]+/[0-9]+" | tail -3

echo ""
echo "------------------------------------------------------------------------"
echo "ğŸ“ˆ æœ€æ–°å‡†ç¡®ç‡:"
echo "------------------------------------------------------------------------"

# æå–æœ€æ–°çš„å‡†ç¡®ç‡
tail -100 "$LATEST_LOG" 2>/dev/null | grep -E "(Train: Loss|Val: Loss)" | tail -6

echo ""
echo "------------------------------------------------------------------------"
echo "ğŸ’¡ å®æ—¶æ—¥å¿—ï¼ˆæœ€å20è¡Œï¼‰:"
echo "------------------------------------------------------------------------"

tail -20 "$LATEST_LOG" 2>/dev/null

echo ""
echo "========================================================================"
echo "ğŸ”„ æŒç»­ç›‘æ§: watch -n 5 bash $0"
echo "ğŸ“„ å®Œæ•´æ—¥å¿—: tail -f $LATEST_LOG"
echo "========================================================================"
