#!/bin/bash
# SIL2603ç™½é“¶æœŸè´§å®Œæ•´æ•°æ®é‡‡é›†å’Œæ¨¡å‹è®­ç»ƒæµç¨‹

set -e  # é‡åˆ°é”™è¯¯å°±åœæ­¢

echo "================================================================================"
echo "ğŸš€ SIL2603ç™½é“¶æœŸè´§ - å®Œæ•´æ•°æ®é‡‡é›†å’Œæ¨¡å‹è®­ç»ƒæµç¨‹"
echo "================================================================================"
echo ""

# åˆ‡æ¢åˆ°å·¥ä½œç›®å½•
cd /home/cx/tigertrade/src

# æ­¥éª¤1: é‡‡é›†å¤§è§„æ¨¡1åˆ†é’Ÿæ•°æ®
echo "ğŸ“¥ æ­¥éª¤1/3: é‡‡é›†å¤§è§„æ¨¡1åˆ†é’ŸKçº¿æ•°æ®ï¼ˆç›®æ ‡90å¤©ï¼‰"
echo "--------------------------------------------------------------------------------"
python collect_massive_1min_data.py --days 90
echo "âœ… æ•°æ®é‡‡é›†å®Œæˆï¼"
echo ""

# è·å–æœ€æ–°ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶
TRAIN_FILE=$(ls -t /home/cx/trading_data/massive_1min/train_*.csv | head -1)
VAL_FILE=$(ls -t /home/cx/trading_data/massive_1min/val_*.csv | head -1)

echo "æ•°æ®æ–‡ä»¶:"
echo "  è®­ç»ƒé›†: $TRAIN_FILE"
echo "  éªŒè¯é›†: $VAL_FILE"
echo ""

# æ­¥éª¤2: è®­ç»ƒæ‰€æœ‰æ¨¡å‹
echo "ğŸ¤– æ­¥éª¤2/3: è®­ç»ƒæ‰€æœ‰æ¨¡å‹ï¼ˆLSTM + Transformer + åŒå¯¹æ¯”ï¼‰"
echo "--------------------------------------------------------------------------------"
python train_all_real_models.py \
    --train-file "$TRAIN_FILE" \
    --val-file "$VAL_FILE" \
    --output-dir /home/cx/trading_data/sil2603_models
echo "âœ… æ¨¡å‹è®­ç»ƒå®Œæˆï¼"
echo ""

# æ­¥éª¤3: ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
echo "ğŸ“Š æ­¥éª¤3/3: ç”Ÿæˆæ€»ç»“æŠ¥å‘Š"
echo "--------------------------------------------------------------------------------"
cat /home/cx/trading_data/sil2603_models/all_models_results.json

echo ""
echo "================================================================================"
echo "âœ… å…¨éƒ¨å®Œæˆï¼"
echo "================================================================================"
echo ""
echo "ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ï¼š"
echo "  - æ•°æ®é›†: /home/cx/trading_data/massive_1min/"
echo "  - æ¨¡å‹: /home/cx/trading_data/sil2603_models/"
echo "  - ç»“æœ: /home/cx/trading_data/sil2603_models/all_models_results.json"
echo ""
