# SIL2603æ•°æ®é‡‡é›†å’Œæ¨¡åž‹è®­ç»ƒå®Œæ•´æµç¨‹è¯´æ˜Ž

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜Žå¦‚ä½•ä¸‹è½½SIL2603ï¼ˆç™½é“¶æœŸè´§ï¼‰çš„å¤§é‡æ•°æ®ï¼ˆ>20000æ¡ï¼‰ï¼Œå¹¶å¯¹æ‰€æœ‰æ¨¡åž‹è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ã€‚

## ç›®å½•ç»“æž„

```
/home/cx/tigertrade/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ download_sil2603_and_train.py    # ä¸»è„šæœ¬ï¼šæ•°æ®é‡‡é›†+è®­ç»ƒ+æµ‹è¯•
â”‚   â”œâ”€â”€ collect_large_dataset.py         # å¤§è§„æ¨¡æ•°æ®é‡‡é›†æ¨¡å—
â”‚   â”œâ”€â”€ train_all_models.py              # æ‰€æœ‰æ¨¡åž‹è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ config.py                        # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ tiger1.py                        # Tiger APIæŽ¥å£
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ data_collection/                 # æ•°æ®é‡‡é›†è„šæœ¬ï¼ˆå‚è€ƒï¼‰
â”‚   â””â”€â”€ analysis/                        # æ•°æ®åˆ†æžè„šæœ¬ï¼ˆå‚è€ƒï¼‰
â””â”€â”€ run_sil2603_download_and_train.sh    # ä¸€é”®å¯åŠ¨è„šæœ¬
```

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆæŽ¨èï¼‰

```bash
cd /home/cx/tigertrade
./run_sil2603_download_and_train.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. ä¸‹è½½SIL2603æ•°æ®ï¼ˆé»˜è®¤60å¤©ï¼Œé¢„è®¡ç”Ÿæˆ20000+æ¡è®°å½•ï¼‰
2. è‡ªåŠ¨è®­ç»ƒæ‰€æœ‰å¯ç”¨æ¨¡åž‹
3. åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ‰€æœ‰æ¨¡åž‹
4. ç”Ÿæˆå®Œæ•´çš„åˆ†æžæŠ¥å‘Š

### æ–¹æ³•2: æ‰‹åŠ¨è¿è¡ŒPythonè„šæœ¬

```bash
cd /home/cx/tigertrade

# åŸºæœ¬ç”¨æ³•ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼Œ60å¤©æ•°æ®ï¼‰
python3 src/download_sil2603_and_train.py --days 60 --min-records 20000 --max-records 50000

# ä½¿ç”¨çœŸå®žAPI
python3 src/download_sil2603_and_train.py --real-api --days 90 --min-records 30000 --max-records 100000

# æŒ‡å®šè¾“å‡ºç›®å½•
python3 src/download_sil2603_and_train.py --days 60 --output-dir /path/to/output
```

## å‚æ•°è¯´æ˜Ž

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜Ž | é»˜è®¤å€¼ |
|------|------|--------|
| `--real-api` | ä½¿ç”¨çœŸå®žTiger APIèŽ·å–æ•°æ® | Falseï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰ |
| `--days` | èŽ·å–å¤©æ•° | 60 |
| `--min-records` | æœ€å°‘è®°å½•æ•°è¦æ±‚ | 20000 |
| `--max-records` | æœ€å¤§è®°å½•æ•°é™åˆ¶ | 50000 |
| `--output-dir` | è¾“å‡ºç›®å½• | `/home/cx/trading_data/sil2603_large_dataset` |

### é…ç½®æ–‡ä»¶å‚æ•°

å¯ä»¥é€šè¿‡çŽ¯å¢ƒå˜é‡æˆ–ä¿®æ”¹ `src/config.py` æ¥è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

#### æ•°æ®é‡‡é›†é…ç½® (DataConfig)

- `DAYS_TO_FETCH`: èŽ·å–å¤©æ•°ï¼ˆé»˜è®¤30ï¼‰
- `MAX_RECORDS`: æœ€å¤§è®°å½•æ•°ï¼ˆé»˜è®¤100000ï¼‰
- `MIN_REQUIRED_BARS`: æœ€å°‘éœ€è¦çš„Kçº¿æ•°é‡ï¼ˆé»˜è®¤50ï¼‰
- `WINDOW_SIZE`: æ»‘åŠ¨çª—å£å¤§å°ï¼ˆé»˜è®¤20ï¼‰

#### æ ‡æ³¨é…ç½® (LabelConfig)

- `STRATEGY`: æ ‡æ³¨ç­–ç•¥ (percentile/std/hybridï¼Œé»˜è®¤percentile)
- `LOOK_AHEAD`: å‘å‰çœ‹å‘¨æœŸï¼ˆé»˜è®¤5ï¼‰
- `PERCENTILE_BUY`: ä¹°å…¥ç™¾åˆ†ä½æ•°é˜ˆå€¼ï¼ˆé»˜è®¤67ï¼‰
- `PERCENTILE_SELL`: å–å‡ºç™¾åˆ†ä½æ•°é˜ˆå€¼ï¼ˆé»˜è®¤33ï¼‰

#### è®­ç»ƒé…ç½® (TrainingConfig)

- `BATCH_SIZE`: æ‰¹æ¬¡å¤§å°ï¼ˆé»˜è®¤32ï¼‰
- `LEARNING_RATE`: å­¦ä¹ çŽ‡ï¼ˆé»˜è®¤0.001ï¼‰
- `NUM_EPOCHS`: è®­ç»ƒè½®æ•°ï¼ˆé»˜è®¤50ï¼‰
- `HIDDEN_DIM`: éšè—å±‚ç»´åº¦ï¼ˆé»˜è®¤128ï¼‰
- `NUM_HEADS`: æ³¨æ„åŠ›å¤´æ•°ï¼ˆé»˜è®¤4ï¼‰
- `NUM_LAYERS`: Transformerå±‚æ•°ï¼ˆé»˜è®¤2ï¼‰
- `EARLY_STOP_PATIENCE`: æ—©åœè€å¿ƒå€¼ï¼ˆé»˜è®¤10ï¼‰

## æ‰§è¡Œæµç¨‹

### é˜¶æ®µ1: æ•°æ®é‡‡é›† ðŸ“¥

1. **èŽ·å–Kçº¿æ•°æ®**
   - 1åˆ†é’ŸKçº¿ï¼ˆç›®æ ‡ï¼šæ ¹æ®å¤©æ•°è®¡ç®—ï¼Œæ¯å¤©çº¦390æ¡ï¼‰
   - 5åˆ†é’ŸKçº¿ï¼ˆç›®æ ‡ï¼šæ ¹æ®å¤©æ•°è®¡ç®—ï¼Œæ¯å¤©çº¦78æ¡ï¼‰

2. **è®¡ç®—ç‰¹å¾**
   - ä»·æ ¼ç‰¹å¾ï¼šå½“å‰ä»·æ ¼ã€ç½‘æ ¼ä¸Šä¸‹è½¨
   - æŠ€æœ¯æŒ‡æ ‡ï¼šATRã€RSIï¼ˆ1må’Œ5mï¼‰ã€å¸ƒæž—å¸¦
   - åŠ¨é‡ç‰¹å¾ï¼šä»·æ ¼å˜åŒ–çŽ‡ï¼ˆ1å‘¨æœŸå’Œ5å‘¨æœŸï¼‰
   - æ³¢åŠ¨çŽ‡ç‰¹å¾
   - æˆäº¤é‡ç‰¹å¾

3. **ç”Ÿæˆæ ‡ç­¾**
   - åŸºäºŽæœªæ¥ä»·æ ¼å˜åŒ–
   - æ”¯æŒå¤šç§æ ‡æ³¨ç­–ç•¥ï¼ˆç™¾åˆ†ä½æ•°ã€æ ‡å‡†å·®ã€æ··åˆï¼‰
   - è¾“å‡ºä¸‰ç±»æ ‡ç­¾ï¼š0=æŒæœ‰ï¼Œ1=ä¹°å…¥ï¼Œ2=å–å‡º

4. **åˆ’åˆ†æ•°æ®é›†**
   - è®­ç»ƒé›†ï¼š70%
   - éªŒè¯é›†ï¼š15%
   - æµ‹è¯•é›†ï¼š15%
   - æ”¯æŒåˆ†å±‚éšæœºåˆ’åˆ†ï¼ˆä¿æŒæ ‡ç­¾åˆ†å¸ƒå‡è¡¡ï¼‰

### é˜¶æ®µ2: æ¨¡åž‹è®­ç»ƒ ðŸ¤–

è®­ç»ƒä»¥ä¸‹æ‰€æœ‰æ¨¡åž‹ï¼š

1. **LLMç­–ç•¥** (LLMTradingStrategy)
2. **å¤§æ¨¡åž‹ç­–ç•¥** (LargeModelStrategy)
3. **è¶…å¤§Transformerç­–ç•¥** (HugeTransformerStrategy)
4. **å¢žå¼ºåž‹Transformerç­–ç•¥** (EnhancedTransformerStrategy)
5. **å¼ºåŒ–å­¦ä¹ ç­–ç•¥** (RLTradingStrategy)
6. **å¤§åž‹Transformerç­–ç•¥** (LargeTransformerStrategy)

æ¯ä¸ªæ¨¡åž‹éƒ½ä¼šï¼š
- åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒ
- åœ¨éªŒè¯é›†ä¸Šè¯„ä¼°
- ä¿å­˜æœ€ä½³æ¨¡åž‹
- è®°å½•è®­ç»ƒæ—¥å¿—

### é˜¶æ®µ3: æµ‹è¯•è¯„ä¼° ðŸ“Š

1. åŠ è½½æ¯ä¸ªæ¨¡åž‹çš„æœ€ä½³æ£€æŸ¥ç‚¹
2. åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°
3. è®¡ç®—æµ‹è¯•å‡†ç¡®çŽ‡å’ŒæŸå¤±
4. ç”ŸæˆæŽ’åæŠ¥å‘Š

## è¾“å‡ºæ–‡ä»¶

æ‰§è¡Œå®ŒæˆåŽï¼Œä¼šåœ¨è¾“å‡ºç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
/home/cx/trading_data/sil2603_large_dataset/
â”œâ”€â”€ train_YYYYMMDD_HHMMSS.csv              # è®­ç»ƒé›†
â”œâ”€â”€ val_YYYYMMDD_HHMMSS.csv                # éªŒè¯é›†
â”œâ”€â”€ test_YYYYMMDD_HHMMSS.csv               # æµ‹è¯•é›†
â”œâ”€â”€ full_YYYYMMDD_HHMMSS.csv               # å®Œæ•´æ•°æ®é›†
â”œâ”€â”€ dataset_info_YYYYMMDD_HHMMSS.txt       # æ•°æ®é›†ä¿¡æ¯
â”œâ”€â”€ collection_log_YYYYMMDD_HHMMSS.txt     # æ•°æ®é‡‡é›†æ—¥å¿—
â”œâ”€â”€ models/                                 # æ¨¡åž‹ç›®å½•
â”‚   â”œâ”€â”€ LLMç­–ç•¥_best.pth
â”‚   â”œâ”€â”€ å¤§æ¨¡åž‹ç­–ç•¥_best.pth
â”‚   â””â”€â”€ ...                                 # å…¶ä»–æ¨¡åž‹
â”œâ”€â”€ training_logs/                          # è®­ç»ƒæ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ training_YYYYMMDD_HHMMSS.log
â”‚   â””â”€â”€ error_YYYYMMDD_HHMMSS.log
â”œâ”€â”€ all_results.json                        # å®Œæ•´ç»“æžœï¼ˆJSONæ ¼å¼ï¼‰
â””â”€â”€ final_report.txt                        # æœ€ç»ˆæŠ¥å‘Šï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
```

## æŸ¥çœ‹ç»“æžœ

### æŸ¥çœ‹æœ€ç»ˆæŠ¥å‘Š

```bash
cat /home/cx/trading_data/sil2603_large_dataset/final_report.txt
```

### æŸ¥çœ‹è¯¦ç»†ç»“æžœï¼ˆJSONï¼‰

```bash
cat /home/cx/trading_data/sil2603_large_dataset/all_results.json | python3 -m json.tool
```

### æŸ¥çœ‹è®­ç»ƒæ—¥å¿—

```bash
# æŸ¥çœ‹æœ€æ–°çš„è®­ç»ƒæ—¥å¿—
ls -lt /home/cx/trading_data/sil2603_large_dataset/training_logs/
tail -f /home/cx/trading_data/sil2603_large_dataset/training_logs/training_*.log
```

## æ€§èƒ½è°ƒä¼˜å»ºè®®

### 1. å¢žåŠ æ•°æ®é‡

å¦‚æžœéœ€è¦æ›´å¤šæ•°æ®ï¼š

```bash
# å¢žåŠ èŽ·å–å¤©æ•°
python3 src/download_sil2603_and_train.py --days 90 --max-records 100000

# æˆ–è€…ä½¿ç”¨çœŸå®žAPI
python3 src/download_sil2603_and_train.py --real-api --days 120 --max-records 150000
```

### 2. è°ƒæ•´è®­ç»ƒå‚æ•°

ä¿®æ”¹ `src/config.py` ä¸­çš„è®­ç»ƒé…ç½®ï¼š

```python
class TrainingConfig:
    NUM_EPOCHS = 100          # å¢žåŠ è®­ç»ƒè½®æ•°
    BATCH_SIZE = 64           # å¢žåŠ æ‰¹æ¬¡å¤§å°ï¼ˆéœ€è¦æ›´å¤šå†…å­˜ï¼‰
    LEARNING_RATE = 0.0001    # é™ä½Žå­¦ä¹ çŽ‡
    HIDDEN_DIM = 256          # å¢žåŠ æ¨¡åž‹å®¹é‡
```

### 3. ä½¿ç”¨GPUåŠ é€Ÿ

ç¡®ä¿CUDAå¯ç”¨å¹¶é…ç½®ï¼š

```python
class TrainingConfig:
    DEVICE = 'cuda'  # ä½¿ç”¨GPU
```

æ£€æŸ¥GPUæ˜¯å¦å¯ç”¨ï¼š

```bash
python3 -c "import torch; print('CUDA available:', torch.cuda.is_available())"
```

### 4. è°ƒæ•´æ ‡æ³¨ç­–ç•¥

å°è¯•ä¸åŒçš„æ ‡æ³¨ç­–ç•¥ï¼š

```python
class LabelConfig:
    STRATEGY = 'hybrid'       # ä½¿ç”¨æ··åˆç­–ç•¥
    LOOK_AHEAD = 10           # å¢žåŠ å‘å‰çœ‹å‘¨æœŸ
    PERCENTILE_BUY = 75       # è°ƒæ•´ä¹°å…¥é˜ˆå€¼
    PERCENTILE_SELL = 25      # è°ƒæ•´å–å‡ºé˜ˆå€¼
```

## æ•…éšœæŽ’é™¤

### é—®é¢˜1: æ•°æ®é‡ä¸è¶³

**é”™è¯¯ä¿¡æ¯**: `âš ï¸ æ•°æ®é‡ä¸è¶³ï¼éœ€è¦è‡³å°‘ 20000 æ¡ï¼Œå®žé™…åªæœ‰ XXX æ¡`

**è§£å†³æ–¹æ¡ˆ**:
1. å¢žåŠ  `--days` å‚æ•°ï¼š`--days 90` æˆ–æ›´å¤š
2. ä½¿ç”¨ `--real-api` èŽ·å–çœŸå®žæ•°æ®
3. é™ä½Ž `--min-records` è¦æ±‚ï¼ˆä¸æŽ¨èï¼‰

### é—®é¢˜2: å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**: `RuntimeError: CUDA out of memory` æˆ– ç³»ç»Ÿå†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
1. å‡å°‘æ‰¹æ¬¡å¤§å°ï¼šä¿®æ”¹ `config.py` ä¸­çš„ `BATCH_SIZE = 16`
2. å‡å°‘æ•°æ®é‡ï¼š`--max-records 30000`
3. ä½¿ç”¨CPUè®­ç»ƒï¼š`config.py` ä¸­è®¾ç½® `DEVICE = 'cpu'`

### é—®é¢˜3: è®­ç»ƒæ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
1. å‡å°‘è®­ç»ƒè½®æ•°ï¼š`NUM_EPOCHS = 20`
2. å‡å°‘æ¨¡åž‹æ•°é‡ï¼šæ³¨é‡ŠæŽ‰ä¸éœ€è¦çš„æ¨¡åž‹
3. ä½¿ç”¨GPUåŠ é€Ÿ
4. å‡å°‘æ•°æ®é‡

### é—®é¢˜4: æ¨¡åž‹å‡†ç¡®çŽ‡ä½Ž

**è§£å†³æ–¹æ¡ˆ**:
1. å¢žåŠ æ•°æ®é‡
2. è°ƒæ•´æ ‡æ³¨ç­–ç•¥å’Œé˜ˆå€¼
3. å¢žåŠ æ¨¡åž‹å®¹é‡ï¼š`HIDDEN_DIM = 256`
4. è°ƒæ•´å­¦ä¹ çŽ‡ï¼šå°è¯• 0.0001 æˆ– 0.01
5. å¢žåŠ è®­ç»ƒè½®æ•°

## é«˜çº§ç”¨æ³•

### ä»…è¿è¡Œæ•°æ®é‡‡é›†

```bash
cd /home/cx/tigertrade
python3 src/collect_large_dataset.py --days 60 --max-records 50000
```

### ä»…è¿è¡Œæ¨¡åž‹è®­ç»ƒ

```bash
cd /home/cx/tigertrade
python3 src/train_all_models.py \
  --train-file /path/to/train.csv \
  --val-file /path/to/val.csv \
  --output-dir /path/to/output
```

### ä½¿ç”¨çŽ°æœ‰æ•°æ®é‡‡é›†è„šæœ¬ï¼ˆå‚è€ƒï¼‰

```bash
# æŸ¥çœ‹çŽ°æœ‰çš„æ•°æ®é‡‡é›†è„šæœ¬
ls -la /home/cx/tigertrade/scripts/data_collection/

# è¿è¡Œç®€å•æ•°æ®é‡‡é›†
python3 /home/cx/tigertrade/scripts/data_collection/simple_data_collector.py

# è¿è¡Œå®šæ—¶åˆ†æž
python3 /home/cx/tigertrade/scripts/analysis/hourly_analysis.py
```

## å‚è€ƒèµ„æ–™

- Tiger APIæ–‡æ¡£ï¼šhttps://quant.itigerup.com/
- PyTorchæ–‡æ¡£ï¼šhttps://pytorch.org/docs/
- TA-Libæ–‡æ¡£ï¼šhttps://mrjbq7.github.io/ta-lib/

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ—¥å¿—æ–‡ä»¶ï¼š`training_logs/error_*.log`
2. æ•°æ®é‡‡é›†æ—¥å¿—ï¼š`collection_log_*.txt`
3. é…ç½®æ–‡ä»¶ï¼š`src/config.py`

---

**æ³¨æ„äº‹é¡¹**:
- é¦–æ¬¡è¿è¡Œå»ºè®®ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆä¸åŠ  `--real-api`ï¼‰ï¼Œå¿«é€ŸéªŒè¯æµç¨‹
- ä½¿ç”¨çœŸå®žAPIéœ€è¦é…ç½®Tiger APIå¯†é’¥
- è®­ç»ƒè¿‡ç¨‹è¾ƒé•¿ï¼Œå»ºè®®ä½¿ç”¨ `nohup` æˆ– `screen` åœ¨åŽå°è¿è¡Œ
- å®šæœŸå¤‡ä»½è®­ç»ƒå¥½çš„æ¨¡åž‹å’Œæ•°æ®

**ç¤ºä¾‹åŽå°è¿è¡Œ**:
```bash
nohup ./run_sil2603_download_and_train.sh > output.log 2>&1 &
```
