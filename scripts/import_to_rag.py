#!/usr/bin/env python3
"""å°†ä»Šå¤©çš„å…³é”®å‘ç°å¯¼å…¥RAGç³»ç»Ÿ"""

import requests
import json
from datetime import datetime
from pathlib import Path
import uuid

RAG_URL = "http://localhost:8000"

def add_document(title, content, doc_type="knowledge", tags=None):
    """æ·»åŠ æ–‡æ¡£åˆ°RAG"""
    doc_id = f"tigertrade-{uuid.uuid4().hex[:12]}"
    
    payload = {
        "id": doc_id,
        "content": f"# {title}\n\n{content}",
        "metadata": {
            "type": doc_type,
            "tags": tags or [],
            "date": datetime.now().isoformat(),
            "project": "tigertrade"
        }
    }
    
    try:
        response = requests.post(f"{RAG_URL}/api/v1/documents", json=payload, timeout=30)
        if response.status_code == 200:
            print(f"âœ… {title}")
            return True
        else:
            print(f"âŒ {title}: {response.text}")
            return False
    except Exception as e:
        print(f"âŒ {title}: {e}")
        return False

print("="*80)
print("ğŸ“ å°†ä»Šå¤©çš„å…³é”®å‘ç°å¯¼å…¥RAGç³»ç»Ÿ")
print("="*80)
print(f"æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")

# æ£€æŸ¥RAGæœåŠ¡
try:
    health = requests.get(f"{RAG_URL}/health", timeout=5).json()
    print(f"âœ… RAGæœåŠ¡æ­£å¸¸")
    print(f"   - ç‰ˆæœ¬: {health['version']}")
    print(f"   - æ¨¡å‹: {health['model']}")
    print(f"   - å·²æœ‰æ–‡æ¡£: {health['document_count']}\n")
except Exception as e:
    print(f"âŒ RAGæœåŠ¡ä¸å¯ç”¨: {e}")
    exit(1)

print("-"*80)
print("å¼€å§‹å¯¼å…¥æ–‡æ¡£...")
print("-"*80 + "\n")

success_count = 0

# 1. Tickæ•°æ®é‡‡é›†çªç ´
if add_document(
    title="2026-01-21: Tickæ•°æ®é‡‡é›†çªç ´",
    content="""
# Tickæ•°æ®é‡‡é›†çªç ´

## æ ¸å¿ƒæˆå°±
- âœ… æˆåŠŸè·å–39,192æ¡ç§’çº§çœŸå®å¸‚åœºTickæ•°æ®
- âœ… å®ç°æŒç»­é‡‡é›†æœºåˆ¶ï¼ˆæ¯60ç§’è‡ªåŠ¨é‡‡é›†ï¼‰
- âœ… æ•°æ®è‡ªåŠ¨æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶ã€å»é‡ã€åˆå¹¶
- âœ… å¯ç§¯ç´¯æ— é™å†å²æ•°æ®

## Tiger APIçš„Tickæ•°æ®é™åˆ¶
- æ–¹æ³•: `get_future_trade_ticks(identifier, begin_index, end_index, limit)`
- ç²’åº¦: æ¯«ç§’çº§æ—¶é—´æˆ³
- é™åˆ¶: åªèƒ½è·å–æœ€è¿‘6-10å°æ—¶çš„Tickï¼ˆçº¦5ä¸‡æ¡ï¼‰
- è§£å†³: æŒç»­é‡‡é›†+æœ¬åœ°å­˜å‚¨

## å…³é”®æ–‡ä»¶
- é‡‡é›†å™¨: /home/cx/tigertrade/src/tick_data_collector.py
- å¯åŠ¨è„šæœ¬: /home/cx/tigertrade/å¯åŠ¨Tické‡‡é›†å™¨.sh
- æ•°æ®ç›®å½•: /home/cx/trading_data/ticks/
- Tickæ•°æ®: SIL2603_ticks_20260121.csv (39,192æ¡)

## æŒç»­é‡‡é›†ä»·å€¼
- æ¯å¤©è‡ªåŠ¨ç§¯ç´¯14ä¸‡æ¡Tick
- 1å‘¨: 100ä¸‡æ¡
- 1æœˆ: 400ä¸‡æ¡
- è¦†ç›–å„ç§å¸‚åœºçŠ¶æ€ï¼Œæå‡æ³›åŒ–æ€§

## å¯åŠ¨å‘½ä»¤
```bash
bash /home/cx/tigertrade/å¯åŠ¨Tické‡‡é›†å™¨.sh
```

## ç®¡ç†å‘½ä»¤
- æŸ¥çœ‹çŠ¶æ€: `ps aux | grep tick_data_collector`
- æŸ¥çœ‹æ—¥å¿—: `tail -f /home/cx/trading_data/ticks/collector.log`
- æŸ¥çœ‹æ•°æ®: `ls -lh /home/cx/trading_data/ticks/*.csv`
- åœæ­¢é‡‡é›†: `pkill -f tick_data_collector.py`
""",
    doc_type="knowledge",
    tags=["tickæ•°æ®", "æ•°æ®é‡‡é›†", "tiger_api", "æŒç»­é‡‡é›†", "2026-01-21"]
):
    success_count += 1

# 2. åŸç”Ÿç‰¹å¾ä¼˜äºäººä¸ºæŒ‡æ ‡çš„æ´å¯Ÿ
if add_document(
    title="æ ¸å¿ƒæ´å¯Ÿ: åŸç”Ÿç‰¹å¾ vs äººä¸ºæŒ‡æ ‡",
    doc_type="knowledge",
    content="""
# åŸç”Ÿç‰¹å¾ä¼˜äºäººä¸ºæŒ‡æ ‡

## ç”¨æˆ·çš„å…³é”®æ´å¯Ÿ
> "çœŸæ­£æœ‰æ•ˆçš„ç‰¹å¾å°±éšè—åœ¨ä»·æ ¼ã€æˆäº¤é‡å’Œæ—¶é—´è½´é‡Œã€‚ä»¥å‰çš„å‚æ•°éƒ½æ˜¯äººä¸ºè®¾è®¡å‡ºæ¥çš„ã€‚å¦‚æœèƒ½è·å–åˆ°ç§’çº§æ•°æ®ï¼Œåº”è¯¥èƒ½é€šè¿‡æ•°æ®åˆ†ææˆ–è€…å¤§æ¨¡å‹æœ¬èº«è·å¾—çœŸæ­£æœ‰æ•ˆçš„ç‰¹å¾ã€‚"

## ä¸ºä»€ä¹ˆåŸç”Ÿç‰¹å¾æ›´å¥½ï¼Ÿ

### ä¼ ç»Ÿæ–¹æ³•çš„å±€é™
- RSI = (ä¸Šæ¶¨å¹³å‡ / (ä¸Šæ¶¨å¹³å‡ + ä¸‹è·Œå¹³å‡)) Ã— 100
- BOLLä¸Šè½¨ = MA(20) + 2Ã—STD(20)
- MACD = EMA(12) - EMA(26)

**é—®é¢˜:**
- âŒ è¿™äº›å…¬å¼æ˜¯1960-1980å¹´ä»£è®¾è®¡çš„
- âŒ åŸºäºå½“æ—¶çš„å¸‚åœºç‰¹å¾å’Œè®¡ç®—èƒ½åŠ›
- âŒ å¯èƒ½ä¸é€‚ç”¨äºç°ä»£é«˜é¢‘å¸‚åœº
- âŒ é—æ¼äº†å¾®è§‚ç»“æ„ä¿¡æ¯

### æ•°æ®é©±åŠ¨æ–¹æ³•çš„ä¼˜åŠ¿
```
è¾“å…¥: åŸå§‹Tick [price, volume, time_delta]
  â†“
Transformer/LSTMè‡ªåŠ¨å­¦ä¹ 
  â†“
å‘ç°:
  âœ… ä»·æ ¼çš„å¾®è§‚è·³åŠ¨æ¨¡å¼
  âœ… æˆäº¤é‡çš„çªå˜ä¿¡å·  
  âœ… è®¢å•æµçš„ä¸å¹³è¡¡
  âœ… äººç±»æ— æ³•å¯Ÿè§‰çš„é«˜ç»´æ¨¡å¼
```

## å¯ä»¥ä»Tickæ•°æ®æå–çš„åŸç”Ÿç‰¹å¾

### 1. ä»·æ ¼å¾®è§‚ç»“æ„
- ä»·æ ¼è·³åŠ¨çš„åˆ†å¸ƒï¼ˆæ­£æ€ï¼Ÿåšå°¾ï¼Ÿå¹‚å¾‹ï¼Ÿï¼‰
- ä»·æ ¼å†²å‡»ï¼ˆå¤§å•åçš„ä»·æ ¼å˜åŒ–ï¼‰
- æ”¯æ’‘/é˜»åŠ›çš„åŠ¨æ€å½¢æˆ

### 2. æˆäº¤é‡æ¨¡å¼
- å¤§å•vså°å•çš„æ¯”ä¾‹å˜åŒ–
- æˆäº¤é‡çˆ†å‘çš„å‰å…†ä¿¡å·
- æµåŠ¨æ€§æ¯ç«­çš„é¢„è­¦

### 3. æ—¶é—´åºåˆ—ä¾èµ–
- Tické—´éš”çš„éå‡åŒ€æ€§
- é«˜é¢‘æ—¶æ®µvsä½é¢‘æ—¶æ®µçš„åˆ‡æ¢
- å¾®è§‚è¶‹åŠ¿çš„æ—©æœŸä¿¡å·

### 4. è®¢å•æµç‰¹å¾
- è¿ç»­ä¹°å…¥å‹åŠ›çš„ç´¯ç§¯
- å–å‹é‡Šæ”¾çš„æ¨¡å¼
- å¤§å•çš„å¸‚åœºå†²å‡»å‡½æ•°

## å®æ–½æ–¹æ¡ˆ
1. ç”¨Transformerç›´æ¥å¤„ç†Tickåºåˆ—
2. è®©æ¨¡å‹è‡ªåŠ¨å­¦ä¹ ç‰¹å¾è¡¨ç¤º
3. ä»æ¨¡å‹éšè—å±‚æå–çŸ¥è¯†
4. åå‘å·¥ç¨‹å‡ºå¯è§£é‡ŠæŒ‡æ ‡
""",
    tags=["ç‰¹å¾å·¥ç¨‹", "åŸç”Ÿç‰¹å¾", "æ·±åº¦å­¦ä¹ ", "å¯è§£é‡Šæ€§"]
):
    success_count += 1

# 3. APIé…ç½®è·¯å¾„ï¼ˆå…³é”®ç»éªŒï¼‰
if add_document(
    title="Tiger APIé…ç½®è·¯å¾„å’Œå‡­è¯",
    doc_type="reference",
    content="""
# Tiger APIé…ç½®

## é…ç½®æ–‡ä»¶ä½ç½®
**è·¯å¾„**: `/home/cx/openapicfg_dem/tiger_openapi_config.properties`

âš ï¸ **é‡è¦**: ä¹‹å‰é…ç½®æ–‡ä»¶æœ‰è¯¯ï¼ˆå¦ä¸€ä¸ªAgentæ¨¡æ‹Ÿç”Ÿæˆçš„å‡é…ç½®ï¼‰ï¼Œå¯¼è‡´æ— æ³•è·å–çœŸå®æ•°æ®

## é…ç½®ç¤ºä¾‹
```
tiger_id=å®é™…çš„tiger_id
private_key_path=./å®é™…çš„ç§é’¥æ–‡ä»¶
account=å®é™…çš„è´¦æˆ·
```

## Pythonä»£ç ä¸­ä½¿ç”¨
```python
from tigeropen.tiger_open_config import TigerOpenClientConfig
from tigeropen.quote.quote_client import QuoteClient

client_config = TigerOpenClientConfig(props_path='./openapicfg_dem')
quote_client = QuoteClient(client_config)
```

## å†å²æ•™è®­
1. **Mockæ•°æ®é—®é¢˜**: å¦‚æœprivate_keyç¼ºå¤±ï¼Œç³»ç»Ÿä¼šå›é€€åˆ°mockæ•°æ®
2. **æ•°æ®éªŒè¯**: å¿…é¡»ç”»Kçº¿å›¾éªŒè¯æ•°æ®çœŸå®æ€§
3. **æ—¶é—´æˆ³æ£€æŸ¥**: æ£€æŸ¥æ•°æ®æ—¶é—´æ˜¯å¦åˆç†
4. **ä»·æ ¼è¿ç»­æ€§**: æ£€æŸ¥ä»·æ ¼æ˜¯å¦æœ‰å¼‚å¸¸è·³è·ƒ

## éªŒè¯æ–¹æ³•
```python
# è·å–æ•°æ®åç«‹å³éªŒè¯
df = quote_client.get_future_bars(...)
print(f"æ—¶é—´èŒƒå›´: {df['datetime'].min()} è‡³ {df['datetime'].max()}")
print(f"ä»·æ ¼èŒƒå›´: {df['close'].min()} è‡³ {df['close'].max()}")
```
""",
    doc_type="configuration",
    tags=["tiger_api", "é…ç½®", "è®¤è¯", "ç»éªŒæ•™è®­"]
):
    success_count += 1

# 4. æ³›åŒ–æ€§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
if add_document(
    title="ç­–ç•¥æ³›åŒ–æ€§é£é™©ä¸è§£å†³æ–¹æ¡ˆ",
    doc_type="lesson_learned",
    content="""
# ç­–ç•¥æ³›åŒ–æ€§é£é™©

## ç”¨æˆ·æå‡ºçš„å…³é”®é—®é¢˜
> "å½“å‰å¸‚åœºçœŸå®æ•°æ®ä¸€ç›´åœ¨ä¸Šæ¶¨ï¼ˆ92%ï¼‰ï¼Œåœ¨è¿™ç§æ¡ä»¶ä¸‹æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“è¾¾åˆ°ç›ˆåˆ©ç‡ï¼Ÿå°±ç®—ä¸€ç›´æŒæœ‰ä¹Ÿèƒ½æå®šã€‚å¸‚åœºçœŸå®æ•°æ®çš„åˆ†å¸ƒæ˜¯ä¸æ˜¯æœ‰è¯¯å¯¼ä½œç”¨ï¼Œä¸‡ä¸€ç™½é“¶å¼€å§‹é•¿æœŸä¸‹è·Œå‘¢ï¼Ÿ"

**è¿™ä¸ªæ‹…å¿§éå¸¸ä¸“ä¸šï¼**

## æ•°æ®åˆ†å¸ƒåå·®
- å½“å‰æ•°æ®: 90å¤©å†…ä¸Šæ¶¨92.50% ($48.86 â†’ $94.06)
- é£é™©: ä»»ä½•"åšå¤š"åå‘çš„æ¨¡å‹éƒ½ä¼šè¡¨ç°å¥½
- é—®é¢˜: å¸‚åœºè½¬è·Œæ—¶å¯èƒ½å…¨é¢å´©æºƒ

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ•°æ®å¢å¼º
```python
åŸå§‹æ•°æ®ï¼ˆä¸Šæ¶¨92%ï¼‰
  â†“
é•œåƒç¿»è½¬ â†’ ç”Ÿæˆä¸‹è·Œ92%çš„æ•°æ®
  â†“
éœ‡è¡åˆæˆ â†’ ç”Ÿæˆæ¨ªç›˜éœ‡è¡æ•°æ®
  â†“
è®­ç»ƒé›†åŒ…å«ï¼šä¸Šæ¶¨+ä¸‹è·Œ+éœ‡è¡
```

### æ–¹æ¡ˆ2: æŒç»­é‡‡é›†ï¼ˆæ¨èï¼‰
```
ä»ç°åœ¨å¼€å§‹æŒç»­é‡‡é›†
  â†“
1å‘¨åï¼šåŒ…å«æœ¬å‘¨çš„ä¸Šæ¶¨+å›è°ƒ
1æœˆåï¼šåŒ…å«ä¸åŒçš„å¸‚åœºçŠ¶æ€
3æœˆåï¼šè¦†ç›–ä¸€è½®å®Œæ•´çš„æ³¢åŠ¨å‘¨æœŸ
  â†“
æ•°æ®è‡ªç„¶åŒ…å«å¤šæ ·æ€§
```

### æ–¹æ¡ˆ3: Market Regimeè¯†åˆ«
```python
# è¯†åˆ«ä¸åŒå¸‚åœºçŠ¶æ€
if trend_strength > 0.7:
    regime = 'å¼ºè¶‹åŠ¿'
elif volatility > threshold:
    regime = 'é«˜æ³¢åŠ¨'
else:
    regime = 'éœ‡è¡'

# åˆ†åˆ«è®­ç»ƒæ¨¡å‹
model_trend = train_on_trend_data()
model_volatile = train_on_volatile_data()
model_range = train_on_range_data()

# å®æ—¶åˆ‡æ¢
current_regime = identify_regime()
model = select_model(current_regime)
```

### æ–¹æ¡ˆ4: å¯¹æŠ—è®­ç»ƒ
```python
# åœ¨æœ€ä¸åˆ©çš„æƒ…å†µä¸‹æµ‹è¯•ç­–ç•¥
worst_case_scenarios = [
    'è¿ç»­10å¤©ä¸‹è·Œ',
    'æš´æ¶¨åæš´è·Œ',
    'é•¿æœŸæ¨ªç›˜åå‡çªç ´',
]

for scenario in worst_case_scenarios:
    test_strategy(scenario)
    if loss > threshold:
        improve_risk_control()
```

## å…³é”®æŒ‡æ ‡
- Sharpe Ratioï¼ˆä¸åŒå¸‚åœºçŠ¶æ€ä¸‹ï¼‰
- Maximum Drawdownï¼ˆæœ€å¤§å›æ’¤ï¼‰
- Win Rate inå„ç§regime
- Calmar Ratioï¼ˆæ”¶ç›Š/å›æ’¤æ¯”ï¼‰
""",
    doc_type="lesson",
    tags=["æ³›åŒ–æ€§", "è¿‡æ‹Ÿåˆ", "é£é™©æ§åˆ¶", "å¸‚åœºçŠ¶æ€"]
):
    success_count += 1

# 5. ç‰¹å¾å·¥ç¨‹ä¸å¤§æ¨¡å‹ç»“åˆ
if add_document(
    title="ç‰¹å¾å·¥ç¨‹ä¸å¤§æ¨¡å‹åˆ†æç»“åˆæ–¹æ¡ˆ",
    doc_type="knowledge",
    content="""
# ç‰¹å¾å·¥ç¨‹ â†” å¤§æ¨¡å‹åˆ†æç»“åˆ

## æ ¸å¿ƒæ€è·¯
ä¸æ˜¯"ç‰¹å¾å·¥ç¨‹ vs æ·±åº¦å­¦ä¹ "ï¼Œè€Œæ˜¯"ä»æ·±åº¦å­¦ä¹ ä¸­å‘ç°å¯è§£é‡Šçš„ç‰¹å¾"

## å››å±‚åˆ†ææ¡†æ¶

### 1. æ³¨æ„åŠ›æƒé‡åˆ†æ
**ç›®æ ‡**: å‘ç°æ¨¡å‹å…³æ³¨å“ªäº›å†å²æ—¶åˆ»

**æ–¹æ³•**:
- æå–Transformerçš„attention weights
- åˆ†æä¸åŒå†³ç­–ï¼ˆä¹°å…¥/æŒæœ‰/å–å‡ºï¼‰æ—¶çš„æ³¨æ„åŠ›æ¨¡å¼
- å‘ç°: æ¨¡å‹å¯èƒ½ç‰¹åˆ«å…³æ³¨"10æ­¥å‰"æˆ–"30æ­¥å‰"çš„ä»·æ ¼

**åº”ç”¨**:
```python
# åŸºäºæ³¨æ„åŠ›æ¨¡å¼è®¾è®¡æŒ‡æ ‡
time_weighted_momentum = (
    price_change[t-3] * 0.5 +  # è¿‘æœŸæƒé‡é«˜
    price_change[t-10] * 0.3 + # ä¸­æœŸæƒé‡ä¸­
    price_change[t-30] * 0.2   # è¿œæœŸæƒé‡ä½
)
```

### 2. éšè—å±‚è¡¨ç¤ºåˆ†æ
**ç›®æ ‡**: å‘ç°æ¨¡å‹è¯†åˆ«çš„"å¸‚åœºçŠ¶æ€"

**æ–¹æ³•**:
- æå–æœ€åä¸€å±‚Transformerçš„éšè—å‘é‡
- ç”¨PCAé™ç»´å¯è§†åŒ–
- ç”¨K-meansèšç±»

**å‘ç°**:
```
çŠ¶æ€1: å¼ºè¶‹åŠ¿ä¸Šæ¶¨ï¼ˆæ¨¡å‹å€¾å‘ä¹°å…¥ï¼‰
çŠ¶æ€2: å¼ºè¶‹åŠ¿ä¸‹è·Œï¼ˆæ¨¡å‹å€¾å‘å–å‡ºï¼‰
çŠ¶æ€3: é«˜æ³¢åŠ¨éœ‡è¡ï¼ˆæ¨¡å‹å€¾å‘æŒæœ‰ï¼‰
çŠ¶æ€4: ä½æ³¢åŠ¨ç›˜æ•´ï¼ˆæ¨¡å‹å€¾å‘æŒæœ‰ï¼‰
çŠ¶æ€5: è½¬æŠ˜ç‚¹ï¼ˆæ¨¡å‹å†³ç­–ä¸ç¡®å®šï¼‰
```

**åº”ç”¨**:
- è¯†åˆ«å½“å‰å¸‚åœºå±äºå“ªä¸ªçŠ¶æ€
- ä¸åŒçŠ¶æ€ä½¿ç”¨ä¸åŒäº¤æ˜“ç­–ç•¥

### 3. ç‰¹å¾é‡è¦æ€§åˆ†æ
**ç›®æ ‡**: è¯†åˆ«å…³é”®åŸå§‹ç‰¹å¾

**æ–¹æ³•**:
- æ¢¯åº¦æ•æ„Ÿæ€§åˆ†æï¼šå¯¹è¾“å…¥ç‰¹å¾æ±‚æ¢¯åº¦
- SHAPå€¼ï¼šè§£é‡Šæ¯ä¸ªç‰¹å¾å¯¹é¢„æµ‹çš„è´¡çŒ®
- Permutation Importanceï¼šæ‰“ä¹±ç‰¹å¾çœ‹æ€§èƒ½ä¸‹é™

**é¢„æœŸå‘ç°**:
```
é‡è¦æ€§æ’å:
1. price_change_pct (ä»·æ ¼å˜åŒ–ç‡)
2. volume_change (æˆäº¤é‡å˜åŒ–)
3. time_delta (æ—¶é—´é—´éš”)
4. price_range (ä»·æ ¼èŒƒå›´)
5. ...
```

**åº”ç”¨**:
- é‡ç‚¹å…³æ³¨Topç‰¹å¾
- è®¾è®¡å¢å¼ºç‰ˆæŒ‡æ ‡

### 4. çŸ¥è¯†è’¸é¦
**ç›®æ ‡**: ä»å¤§æ¨¡å‹æå–ç®€å•è§„åˆ™

**æ–¹æ³•**:
```python
# è®­ç»ƒå†³ç­–æ ‘æ¨¡æ‹ŸTransformer
X = raw_features
y = transformer_predictions  # ç”¨å¤§æ¨¡å‹çš„é¢„æµ‹ä½œä¸ºæ ‡ç­¾

dt = DecisionTreeClassifier(max_depth=5)
dt.fit(X, y)

# æå–è§„åˆ™
rules = export_text(dt)
```

**ç»“æœ**: å¾—åˆ°å¯è§£é‡Šçš„if-thenè§„åˆ™
```
IF price_change_pct > 0.5% AND volume_change > 20%:
    â†’ ä¹°å…¥ä¿¡å·
ELIF price_change_pct < -0.5% AND volume_anomaly > 2:
    â†’ å–å‡ºä¿¡å·
...
```

## å®æ–½è®¡åˆ’

### Phase 1: æ¨¡å‹è®­ç»ƒ
- âœ… è®­ç»ƒTransformeræ¨¡å‹ï¼ˆåŸºäºåŸç”Ÿç‰¹å¾ï¼‰

### Phase 2: ç‰¹å¾å‘ç°ï¼ˆå·²åˆ›å»ºè„šæœ¬ï¼‰
- æ–‡ä»¶: /home/cx/tigertrade/src/feature_discovery_from_model.py
- åŠŸèƒ½:
  1. æå–æ³¨æ„åŠ›æƒé‡
  2. åˆ†æéšè—å±‚è¡¨ç¤º
  3. è®¡ç®—ç‰¹å¾é‡è¦æ€§
  4. å‘ç°è‡ªå®šä¹‰æŒ‡æ ‡

### Phase 3: éªŒè¯ä¸åº”ç”¨
- å¯¹æ¯”è‡ªå®šä¹‰æŒ‡æ ‡ vs ä¼ ç»ŸæŒ‡æ ‡ï¼ˆRSI/BOLLï¼‰
- å›æµ‹éªŒè¯
- å®ç›˜æµ‹è¯•

## å…³é”®insight
**å¤§æ¨¡å‹ä¸æ˜¯é»‘ç›’**ï¼Œè€Œæ˜¯"çŸ¥è¯†çŸ¿å±±"ï¼š
- æ³¨æ„åŠ›æƒé‡ = æ—¶é—´é‡è¦æ€§
- éšè—å±‚èšç±» = å¸‚åœºçŠ¶æ€åˆ†ç±»
- ç‰¹å¾æ¢¯åº¦ = åŸå§‹ç‰¹å¾é‡è¦æ€§
- çŸ¥è¯†è’¸é¦ = å¯è§£é‡Šè§„åˆ™
""",
    doc_type="methodology",
    tags=["ç‰¹å¾å·¥ç¨‹", "æ·±åº¦å­¦ä¹ ", "å¯è§£é‡Šæ€§", "æ³¨æ„åŠ›æœºåˆ¶", "çŸ¥è¯†è’¸é¦"]
):
    success_count += 1

# 6. æ•°æ®èµ„äº§æ¸…å•
if add_document(
    title="å·²é‡‡é›†çš„çœŸå®å¸‚åœºæ•°æ®æ¸…å•",
    doc_type="reference",
    content="""
# çœŸå®å¸‚åœºæ•°æ®èµ„äº§æ¸…å•

## é«˜é¢‘æ•°æ®
1. **Tickæ•°æ®** (ç§’çº§/æ¯«ç§’çº§)
   - æ–‡ä»¶: /home/cx/trading_data/ticks/SIL2603_ticks_20260121.csv
   - æ•°é‡: 39,192æ¡
   - æ—¶é—´è·¨åº¦: 6.38å°æ—¶
   - èŒƒå›´: 2026-01-20 23:00 è‡³ 2026-01-21 05:27

2. **1åˆ†é’ŸKçº¿**
   - æ–‡ä»¶: /home/cx/trading_data/SIL2603_1min_combined.csv
   - æ•°é‡: 2,382æ¡
   - æ—¶é—´è·¨åº¦: 3å¤©

3. **5åˆ†é’ŸKçº¿**
   - æ–‡ä»¶: /home/cx/trading_data/SIL2603_5min_7days.csv
   - æ•°é‡: 1,000æ¡
   - æ—¶é—´è·¨åº¦: 7å¤©

## ä¸­ä½é¢‘æ•°æ®
4. **1å°æ—¶Kçº¿**
   - æ–‡ä»¶: /home/cx/trading_data/SIL2603_1h_30days.csv
   - æ•°é‡: 455æ¡
   - æ—¶é—´è·¨åº¦: 30å¤©

5. **æ—¥Kçº¿**
   - æ–‡ä»¶: /home/cx/trading_data/SIL2603_daily_90days.csv
   - æ•°é‡: 60æ¡
   - æ—¶é—´è·¨åº¦: 90å¤© (2025-10-23 è‡³ 2026-01-20)
   - ä»·æ ¼: $48.86 â†’ $94.06 (+92.50%)

## ç”¨æˆ·çœŸå®äº¤æ˜“æ•°æ®
6. **äº¤æ˜“è®°å½•**
   - æ–‡ä»¶: /home/cx/tigertrade/docs/SILç™½é“¶æœŸè´§äº¤æ˜“åˆ†æ_å®Œæ•´ç‰ˆ.xlsx
   - æ•°é‡: 70æ¡äº¤æ˜“
   - æ—¶é—´: 2026-01-01 è‡³ 2026-01-19

7. **äº¤æ˜“è½®æ¬¡**
   - æ–‡ä»¶: /home/cx/tigertrade/docs/SILäº¤æ˜“è½®æ¬¡åˆ†æ.xlsx
   - æ•°é‡: 15è½®å®Œæ•´äº¤æ˜“

## æ•°æ®è¦†ç›–æƒ…å†µ

### ç”¨æˆ·äº¤æ˜“æ—¶æ®µ(2026-01-01 è‡³ 01-19)çš„è¦†ç›–:
- âœ… æ—¥Kçº¿: 11æ¡ï¼ˆå®Œæ•´è¦†ç›–ï¼‰
- âœ… 1å°æ—¶Kçº¿: 255æ¡ï¼ˆå®Œæ•´è¦†ç›–ï¼‰
- âš ï¸ 5åˆ†é’ŸKçº¿: 414æ¡ï¼ˆä»…01-15è‡³01-19ï¼‰
- âš ï¸ 1åˆ†é’ŸKçº¿: 61æ¡ï¼ˆä»…01-18è‡³01-19ï¼‰
- âŒ Tickæ•°æ®: 0æ¡ï¼ˆä¸è¦†ç›–ï¼‰

### åŸå› 
Tiger APIå¯¹é«˜é¢‘å†å²æ•°æ®çš„ä¿ç•™æœŸé™æœ‰é™ï¼š
- 1åˆ†é’Ÿ: çº¦7-10å¤©
- Tick: å½“æ—¥æˆ–æœ€è¿‘äº¤æ˜“æ—¥

### è§£å†³æ–¹æ¡ˆ
æŒç»­é‡‡é›†å™¨å·²å¯åŠ¨ï¼Œå°†ç§¯ç´¯æœªæ¥çš„å®Œæ•´æ•°æ®

## åˆå¹¶æ•°æ®é›†
- **è®­ç»ƒé›†**: /home/cx/trading_data/train_raw_features.csv (34,471æ¡ï¼Œ80%)
- **éªŒè¯é›†**: /home/cx/trading_data/val_raw_features.csv (8,618æ¡ï¼Œ20%)
- **æ€»è®¡**: 43,089æ¡çœŸå®å¸‚åœºæ•°æ®

## æ•°æ®è´¨é‡
- âœ… æ—¶é—´æˆ³åˆç†
- âœ… ä»·æ ¼è¿ç»­
- âœ… æˆäº¤é‡çœŸå®
- âœ… Kçº¿å›¾éªŒè¯é€šè¿‡ï¼ˆç”¨æˆ·ç¡®è®¤ï¼‰
""",
    doc_type="documentation",
    tags=["æ•°æ®èµ„äº§", "æ•°æ®æ¸…å•", "SIL2603", "ç™½é“¶æœŸè´§"]
):
    success_count += 1

# 7. å…³é”®è„šæœ¬å’Œå·¥å…·
if add_document(
    title="å…³é”®è„šæœ¬å’Œå·¥å…·æ¸…å•",
    doc_type="reference",
    content="""
# å…³é”®è„šæœ¬å’Œå·¥å…·æ¸…å•

## æ•°æ®é‡‡é›†
1. **Tickæ•°æ®æŒç»­é‡‡é›†å™¨**
   - è„šæœ¬: /home/cx/tigertrade/src/tick_data_collector.py
   - å¯åŠ¨: /home/cx/tigertrade/å¯åŠ¨Tické‡‡é›†å™¨.sh
   - åŠŸèƒ½: æ¯60ç§’é‡‡é›†æœ€æ–°Tickï¼Œè‡ªåŠ¨ä¿å­˜ã€å»é‡
   - æ•°æ®ç›®å½•: /home/cx/trading_data/ticks/

2. **å†å²Kçº¿é‡‡é›†**
   - Tiger APIæ–¹æ³•: `quote_client.get_future_bars()`
   - å‘¨æœŸ: DAY, ONE_HOUR, FIVE_MINUTES, ONE_MINUTE
   - åˆçº¦: SIL2603 (ç™½é“¶æœŸè´§)

## æ¨¡å‹è®­ç»ƒ
3. **åŸç”Ÿç‰¹å¾Transformeræ¨¡å‹**
   - è„šæœ¬: /home/cx/tigertrade/src/train_raw_features_transformer.py
   - ç‰¹ç‚¹: ä¸ä½¿ç”¨RSI/BOLLç­‰äººä¸ºæŒ‡æ ‡
   - è¾“å…¥: åŸå§‹ä»·æ ¼ã€æˆäº¤é‡ã€æ—¶é—´é—´éš”
   - æ¶æ„: Transformer Encoder (4å±‚, 8å¤´æ³¨æ„åŠ›)

4. **ç‰¹å¾å‘ç°åˆ†æ**
   - è„šæœ¬: /home/cx/tigertrade/src/feature_discovery_from_model.py
   - åŠŸèƒ½:
     * æå–æ³¨æ„åŠ›æƒé‡
     * åˆ†æéšè—å±‚è¡¨ç¤ºï¼ˆèšç±»è¯†åˆ«å¸‚åœºçŠ¶æ€ï¼‰
     * è®¡ç®—ç‰¹å¾é‡è¦æ€§ï¼ˆæ¢¯åº¦æ•æ„Ÿæ€§ï¼‰
     * å‘ç°è‡ªå®šä¹‰æŒ‡æ ‡

## ç­–ç•¥å›æµ‹
5. **ç”¨æˆ·é£æ ¼ç­–ç•¥**
   - è„šæœ¬: /home/cx/tigertrade/src/strategy_user_style.py
   - ç‰¹ç‚¹: æ¨¡æ‹Ÿç”¨æˆ·æ‰‹å·¥äº¤æ˜“é£æ ¼ï¼ˆåˆ†æ‰¹å»ºä»“ã€çµæ´»æ­¢æŸï¼‰

6. **å›æµ‹æ¡†æ¶**
   - è„šæœ¬: /home/cx/tigertrade/scripts/backtest_user_style.py

## ç›‘æ§å’Œç®¡ç†
7. **è®­ç»ƒè¿›åº¦ç›‘æ§**
   - è„šæœ¬: /home/cx/tigertrade/æŸ¥çœ‹è®­ç»ƒè¿›åº¦.sh

8. **Tické‡‡é›†ç›‘æ§**
   ```bash
   # æŸ¥çœ‹é‡‡é›†çŠ¶æ€
   ps aux | grep tick_data_collector
   
   # å®æ—¶æ—¥å¿—
   tail -f /home/cx/trading_data/ticks/collector.log
   
   # æŸ¥çœ‹æ•°æ®
   ls -lh /home/cx/trading_data/ticks/
   ```

## æ•°æ®ç®¡ç†
9. **æ•°æ®æ ‡å‡†åŒ–ç›®å½•**
   ```
   /home/cx/trading_data/
   â”œâ”€â”€ ticks/              # Tickæ•°æ®ï¼ˆæŒ‰æ—¥æœŸåˆ†æ–‡ä»¶ï¼‰
   â”œâ”€â”€ train_raw_features.csv
   â”œâ”€â”€ val_raw_features.csv
   â”œâ”€â”€ all_data_raw_features.csv
   â””â”€â”€ SIL2603_*.csv       # å„å‘¨æœŸKçº¿
   ```

10. **æ¨¡å‹å­˜å‚¨**
    ```
    /home/cx/tigertrade/models/
    â””â”€â”€ transformer_raw_features_best.pth
    ```

## APIé…ç½®
11. **Tiger APIé…ç½®**
    - è·¯å¾„: /home/cx/openapicfg_dem/tiger_openapi_config.properties
    - é‡è¦: ç¡®ä¿private_key_pathæŒ‡å‘çœŸå®ç§é’¥

## æ–‡æ¡£
12. **å…³é”®æ–‡æ¡£**
    - Tickæ•°æ®æ–¹æ¡ˆ: /home/cx/tigertrade/docs/Tickæ•°æ®é‡‡é›†å®Œæ•´æ–¹æ¡ˆ.md
    - æ€»ç»“: /home/cx/tigertrade/docs/20260121_æœ€ç»ˆæ€»ç»“_Tickæ•°æ®çªç ´.md
    - Kçº¿å›¾: /home/cx/tigertrade/docs/çœŸå®Tickæ•°æ®å®Œæ•´åˆ†æå›¾.png
""",
    doc_type="documentation",
    tags=["è„šæœ¬", "å·¥å…·", "æ–‡æ¡£", "ç›®å½•ç»“æ„"]
):
    success_count += 1

print(f"\n{'='*80}")
print(f"ğŸ“Š å¯¼å…¥å®Œæˆç»Ÿè®¡")
print(f"{'='*80}")
print(f"æˆåŠŸå¯¼å…¥: {success_count} ä¸ªæ–‡æ¡£")
print(f"æ€»æ–‡æ¡£æ•°: {requests.get(f'{RAG_URL}/health').json()['document_count']}")
print(f"{'='*80}\n")

# éªŒè¯ï¼šæœç´¢æµ‹è¯•
print("éªŒè¯RAGç³»ç»Ÿ...")
test_query = "Tickæ•°æ®é‡‡é›†"
response = requests.post(
    f"{RAG_URL}/api/v1/search",
    json={"query": test_query, "top_k": 3}
)

if response.status_code == 200:
    results = response.json()
    print(f"âœ… æœç´¢æµ‹è¯•é€šè¿‡: '{test_query}'")
    print(f"   æ‰¾åˆ° {len(results['results'])} ä¸ªç›¸å…³æ–‡æ¡£")
    for r in results['results'][:2]:
        content_preview = r['content'][:60].replace('\n', ' ')
        print(f"   - {r['id']}: {content_preview}... (ç›¸å…³åº¦: {r['score']:.3f})")
else:
    print(f"âš ï¸ æœç´¢æµ‹è¯•å¤±è´¥: {response.text}")

print(f"\n{'='*80}")
print(f"âœ… RAGç³»ç»Ÿå·²å®Œå…¨ä¿®å¤å¹¶å¯¼å…¥ä»Šå¤©çš„å…³é”®ä¿¡æ¯ï¼")
print(f"{'='*80}\n")
